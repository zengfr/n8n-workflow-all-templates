{
  "id": "bbyKb0xYqFgRFr8T",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Monitor revenue tax compliance and auto-correct anomalies with Anthropic, MagicCSV, Gmail and WhatsApp",
    "wechat": "youandme10086",
    "id": 12790,
    "update_time": "2026-02-13"
  },
  "name": "Revenue Tax Compliance Monitoring and Automated Correction System",
  "tags": [],
  "nodes": [
    {
      "id": "bc9f080a-eec0-4e7e-adec-bbf24989d4b1",
      "name": "Weekly/Monthly Schedule",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        0,
        0
      ],
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                1
              ],
              "triggerAtHour": 9
            }
          ]
        }
      },
      "typeVersion": 1.3
    },
    {
      "id": "7a0e9645-ef3c-413d-91dd-ac697e0c66f6",
      "name": "Workflow Configuration",
      "type": "n8n-nodes-base.set",
      "position": [
        224,
        0
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "accountingApiUrl",
              "type": "string",
              "value": "<__PLACEHOLDER_VALUE__Accounting Software API URL__>"
            },
            {
              "id": "id-2",
              "name": "accountingApiKey",
              "type": "string",
              "value": "<__PLACEHOLDER_VALUE__Accounting Software API Key__>"
            },
            {
              "id": "id-3",
              "name": "taxAgentEmail",
              "type": "string",
              "value": "<__PLACEHOLDER_VALUE__Tax Agent Email Address__>"
            },
            {
              "id": "id-4",
              "name": "whatsappPhoneNumber",
              "type": "string",
              "value": "<__PLACEHOLDER_VALUE__WhatsApp Phone Number (with country code)__>"
            }
          ]
        },
        "includeOtherFields": true
      },
      "typeVersion": 3.4
    },
    {
      "id": "a49239a6-46f8-43d0-900c-aecc1a69d85f",
      "name": "Fetch Revenue Data",
      "type": "n8n-nodes-base.n8n",
      "position": [
        448,
        0
      ],
      "parameters": {
        "filters": {},
        "options": {},
        "resource": "execution",
        "returnAll": true,
        "requestOptions": {}
      },
      "typeVersion": 1
    },
    {
      "id": "c60ecd66-6758-4f7c-a15d-f19dd5cf0400",
      "name": "Tax Categorization Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        672,
        0
      ],
      "parameters": {
        "text": "={{ $json }}",
        "options": {
          "systemMessage": "You are a tax compliance specialist responsible for categorizing revenue streams by applicable tax rules.\n\nYour task is to:\n1. Analyze each revenue transaction from the provided data\n2. Identify the revenue type (product sales, services, subscriptions, etc.)\n3. Determine the applicable tax category (VAT, sales tax, exempt, etc.)\n4. Assign the correct tax rate based on jurisdiction and product/service type\n5. Flag any transactions that require special tax treatment\n\nReturn the categorized revenue data in the structured JSON format defined by the output parser."
        },
        "promptType": "define",
        "hasOutputParser": true
      },
      "typeVersion": 3.1
    },
    {
      "id": "f0fb76c9-d34e-438f-8851-e77b355124cd",
      "name": "Anomaly Detection Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1024,
        0
      ],
      "parameters": {
        "text": "={{ $json }}",
        "options": {
          "systemMessage": "You are an anomaly detection specialist for tax compliance monitoring.\n\nYour task is to:\n1. Review the categorized revenue data from the previous agent\n2. Detect anomalies such as:\n   - Missing invoices or invoice numbers\n   - Incorrect tax categories for specific products/services\n   - Unusual tax rates or calculations\n   - Duplicate transactions\n   - Revenue entries without proper documentation\n   - Mismatched amounts between invoice and payment\n3. Assess the severity of each anomaly (critical, high, medium, low)\n4. Provide a clear description of each issue found\n\nReturn the detected anomalies in the structured JSON format defined by the output parser."
        },
        "promptType": "define",
        "hasOutputParser": true
      },
      "typeVersion": 3.1
    },
    {
      "id": "777b0dc9-5283-4e1e-81f2-20e10ed078d9",
      "name": "Correction Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1432,
        0
      ],
      "parameters": {
        "text": "={{ $json }}",
        "options": {
          "systemMessage": "You are a tax compliance correction specialist.\n\nYour task is to:\n1. Review the anomalies detected by the previous agent\n2. For each anomaly, determine the appropriate correction:\n   - Draft corrected tax category assignments\n   - Suggest proper invoice numbers or documentation\n   - Recalculate tax amounts if needed\n   - Propose adjustments to revenue entries\n3. Provide clear correction instructions that can be applied to the accounting system\n4. Include the original transaction ID and the corrected values\n5. Add notes explaining why the correction is needed\n\nReturn the corrections in the structured JSON format defined by the output parser."
        },
        "promptType": "define",
        "hasOutputParser": true
      },
      "typeVersion": 3.1
    },
    {
      "id": "2f953c16-89c1-4ae0-a9ed-e8125cbe939e",
      "name": "Sync to Accounting Software",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1840,
        0
      ],
      "parameters": {
        "url": "={{ $('Workflow Configuration').first().json.accountingApiUrl }}",
        "method": "POST",
        "options": {},
        "jsonBody": "={{ $json }}",
        "sendBody": true,
        "sendHeaders": true,
        "specifyBody": "json",
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Workflow Configuration').first().json.accountingApiKey }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "typeVersion": 4.3
    },
    {
      "id": "aa0ab3a1-3866-4e62-a94d-e8b4fb008830",
      "name": "Format Compliance Summary",
      "type": "n8n-nodes-base.set",
      "position": [
        2064,
        0
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "summaryTitle",
              "type": "string",
              "value": "=Tax Compliance Report - {{ $now.format(\"MMMM YYYY\") }}"
            },
            {
              "id": "id-2",
              "name": "reportDate",
              "type": "string",
              "value": "={{ $now.toISO() }}"
            },
            {
              "id": "id-3",
              "name": "totalTransactionsReviewed",
              "type": "number",
              "value": "={{ $('Tax Categorization Agent').all().length }}"
            },
            {
              "id": "id-4",
              "name": "anomaliesDetected",
              "type": "number",
              "value": "={{ $('Anomaly Detection Agent').first().json.anomalies?.length || 0 }}"
            },
            {
              "id": "id-5",
              "name": "correctionsApplied",
              "type": "number",
              "value": "={{ $('Correction Agent').first().json.corrections?.length || 0 }}"
            },
            {
              "id": "id-6",
              "name": "syncStatus",
              "type": "string",
              "value": "={{ $('Sync to Accounting Software').first().json.status || 'completed' }}"
            }
          ]
        },
        "includeOtherFields": true
      },
      "typeVersion": 3.4
    },
    {
      "id": "ab735744-cb75-47b1-89e8-78c831446f8c",
      "name": "Send Summary to Tax Agent",
      "type": "n8n-nodes-base.gmail",
      "position": [
        2288,
        0
      ],
      "webhookId": "389ad47c-ad6f-4574-b034-10719dd6851d",
      "parameters": {
        "sendTo": "={{ $('Workflow Configuration').first().json.taxAgentEmail }}",
        "message": "=<h2>{{ $json.summaryTitle }}</h2>\n<p><strong>Report Date:</strong> {{ $json.reportDate }}</p>\n<p><strong>Total Transactions Reviewed:</strong> {{ $json.totalTransactionsReviewed }}</p>\n<p><strong>Anomalies Detected:</strong> {{ $json.anomaliesDetected }}</p>\n<p><strong>Corrections Applied:</strong> {{ $json.correctionsApplied }}</p>\n<p><strong>Sync Status:</strong> {{ $json.syncStatus }}</p>\n<hr>\n<p>Please review the attached compliance data for this period.</p>",
        "options": {},
        "subject": "={{ $json.summaryTitle }}"
      },
      "credentials": {
        "gmailOAuth2": {
          "id": "u1N5nBDvQ0AWhNnV",
          "name": "Gmail account"
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "9d8e114b-e1ff-4c3c-8882-b5c95f860118",
      "name": "Categorization Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "position": [
        808,
        224
      ],
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"transactionId\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Unique transaction identifier\"\n\t\t},\n\t\t\"revenueType\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Type of revenue (product, service, subscription, etc.)\"\n\t\t},\n\t\t\"taxCategory\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Applicable tax category (VAT, sales tax, exempt, etc.)\"\n\t\t},\n\t\t\"taxRate\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Tax rate percentage\"\n\t\t},\n\t\t\"amount\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Transaction amount\"\n\t\t},\n\t\t\"taxAmount\": {\n\t\t\t\"type\": \"number\",\n\t\t\t\"description\": \"Calculated tax amount\"\n\t\t},\n\t\t\"specialTreatment\": {\n\t\t\t\"type\": \"boolean\",\n\t\t\t\"description\": \"Whether special tax treatment is required\"\n\t\t}\n\t}\n}"
      },
      "typeVersion": 1.3
    },
    {
      "id": "c33a5f58-d091-480e-90eb-f7efdac55312",
      "name": "Anomaly Detection Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "position": [
        1160,
        224
      ],
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"anomalies\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"description\": \"List of detected anomalies\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"transactionId\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"anomalyType\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"description\": \"Type of anomaly (missing_invoice, incorrect_category, etc.)\"\n\t\t\t\t\t},\n\t\t\t\t\t\"severity\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"description\": \"Severity level (critical, high, medium, low)\"\n\t\t\t\t\t},\n\t\t\t\t\t\"description\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"description\": \"Detailed description of the issue\"\n\t\t\t\t\t},\n\t\t\t\t\t\"affectedAmount\": {\n\t\t\t\t\t\t\"type\": \"number\",\n\t\t\t\t\t\t\"description\": \"Transaction amount affected\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}"
      },
      "typeVersion": 1.3
    },
    {
      "id": "d8b1c051-deef-417b-8276-0930051d643d",
      "name": "Correction Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "position": [
        1632,
        224
      ],
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"corrections\": {\n\t\t\t\"type\": \"array\",\n\t\t\t\"description\": \"List of corrections to apply\",\n\t\t\t\"items\": {\n\t\t\t\t\"type\": \"object\",\n\t\t\t\t\"properties\": {\n\t\t\t\t\t\"transactionId\": {\n\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t},\n\t\t\t\t\t\"correctionType\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"description\": \"Type of correction needed\"\n\t\t\t\t\t},\n\t\t\t\t\t\"originalValue\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"description\": \"Original incorrect value\"\n\t\t\t\t\t},\n\t\t\t\t\t\"correctedValue\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"description\": \"Corrected value to apply\"\n\t\t\t\t\t},\n\t\t\t\t\t\"notes\": {\n\t\t\t\t\t\t\"type\": \"string\",\n\t\t\t\t\t\t\"description\": \"Explanation of why correction is needed\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}"
      },
      "typeVersion": 1.3
    },
    {
      "id": "2a03aabb-ed5a-4511-8dd5-8c0cd9955bfc",
      "name": "Anthropic Model - Categorization",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "position": [
        680,
        224
      ],
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-5-20250929",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {}
      },
      "credentials": {
        "anthropicApi": {
          "id": "S8laStQPC1u3EYuZ",
          "name": "Anthropic account"
        }
      },
      "typeVersion": 1.3
    },
    {
      "id": "6d84202d-bb10-449c-beff-5219f46b391d",
      "name": "Anthropic Model - Anomaly Detection",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "position": [
        1032,
        224
      ],
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-5-20250929",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {}
      },
      "credentials": {
        "anthropicApi": {
          "id": "S8laStQPC1u3EYuZ",
          "name": "Anthropic account"
        }
      },
      "typeVersion": 1.3
    },
    {
      "id": "cd41cc6a-079a-4d09-90af-ef63719d3ff5",
      "name": "Anthropic Model - Correction",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "position": [
        1376,
        224
      ],
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-5-20250929",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {}
      },
      "credentials": {
        "anthropicApi": {
          "id": "S8laStQPC1u3EYuZ",
          "name": "Anthropic account"
        }
      },
      "typeVersion": 1.3
    },
    {
      "id": "2828c382-c79f-46b6-b155-63da5e4d509f",
      "name": "Send WhatsApp Alert",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2512,
        0
      ],
      "webhookId": "36c254ac-a66b-4103-a10f-8124db7e58c5",
      "parameters": {
        "textBody": "=Tax Compliance Alert\n\n{{ $json.summaryTitle }}\n\nAnomalies Detected: {{ $json.anomaliesDetected }}\nCorrections Applied: {{ $json.correctionsApplied }}\nSync Status: {{ $json.syncStatus }}\n\nFull report sent via email.",
        "operation": "send",
        "additionalFields": {},
        "recipientPhoneNumber": "={{ $('Workflow Configuration').first().json.whatsappPhoneNumber }}"
      },
      "credentials": {
        "whatsAppApi": {
          "id": "LlXrXZvNBEzrQsXs",
          "name": "WhatsApp account"
        }
      },
      "typeVersion": 1.1
    },
    {
      "id": "ac1eebc9-dadc-4dc2-9f04-ade808041eb5",
      "name": "MCP Client Tool",
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "position": [
        1504,
        224
      ],
      "parameters": {
        "options": {}
      },
      "typeVersion": 1.2
    },
    {
      "id": "0869192b-462f-4741-bfe9-41ee6a1f4e9a",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        -496
      ],
      "parameters": {
        "width": 560,
        "height": 288,
        "content": "## How It Works\nThis workflow automates tax compliance monitoring and revenue analysis for accounting teams and finance managers handling multi-source income data. It solves the critical problem of manually tracking revenue streams, identifying tax anomalies, and ensuring regulatory compliance across multiple data sources. The system fetches revenue data from accounting software via MagicCSV, processes it through three specialized AI models for categorization, anomaly detection, and compliance verification, then automatically syncs validated results to accounting systems and sends tax summary reports via email and WhatsApp. This eliminates hours of manual review, reduces compliance errors, and provides real-time tax insights."
      },
      "typeVersion": 1
    },
    {
      "id": "8ee243be-d7c7-42f3-8d4a-f78926584c48",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        624,
        -496
      ],
      "parameters": {
        "width": 544,
        "height": 224,
        "content": "## Setup Steps\n1. Configure MagicCSV integration with your accounting software API credentials\n2. Add Anthropic API key for categorization, anomaly detection, and compliance models\n3. Connect accounting software webhook/API for bidirectional sync\n4. Set up Gmail authentication for automated report distribution\n5. Configure WhatsApp Business API credentials for instant alerts"
      },
      "typeVersion": 1
    },
    {
      "id": "b1449dcb-1d4f-4235-a316-f34f23cfeedf",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1216,
        -624
      ],
      "parameters": {
        "color": 6,
        "width": 464,
        "height": 352,
        "content": "## Prerequisites\nAnthropic API access, MagicCSV account, accounting software with API capabilities\n## Use Cases\nMulti-entity corporations tracking cross-border revenue, e-commerce businesses with diverse income streams\n## Customization\nModify AI prompts for industry-specific tax rules, add custom anomaly thresholds\n## Benefits\nReduces manual tax review time by 80%, minimizes compliance errors through triple AI validation"
      },
      "typeVersion": 1
    },
    {
      "id": "c8c071f2-e6eb-42c4-a265-9e0e14da99b1",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1808,
        -128
      ],
      "parameters": {
        "color": 7,
        "width": 896,
        "height": 640,
        "content": "## Automated Distribution\n**Why:** Simultaneous sync to accounting software and multi-channel notifications (Gmail, WhatsApp) ensure stakeholders receive timely compliance updates."
      },
      "typeVersion": 1
    },
    {
      "id": "54d793f5-4dca-4da7-820a-dca4b4985d08",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        640,
        -128
      ],
      "parameters": {
        "color": 7,
        "width": 1136,
        "height": 768,
        "content": "## AI-Powered Triple Validation\n**Why:** Three-stage AI analysis (categorization, anomaly detection, compliance checking) ensures accurate tax classification and identifies potential issues before submission."
      },
      "typeVersion": 1
    },
    {
      "id": "1fe640a9-2b46-47a2-8199-10c3ab047023",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -32,
        -128
      ],
      "parameters": {
        "color": 7,
        "width": 640,
        "height": 608,
        "content": "## Scheduled Data Retrieval\n**Why:** Automated weekly/monthly fetching ensures continuous monitoring without manual intervention, maintaining up-to-date tax records."
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "availableInMCP": false,
    "executionOrder": "v1"
  },
  "versionId": "6e5ddab7-a9cc-41e6-b0ce-853fa094d284",
  "connections": {
    "MCP Client Tool": {
      "ai_tool": [
        [
          {
            "node": "Correction Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Correction Agent": {
      "main": [
        [
          {
            "node": "Sync to Accounting Software",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Revenue Data": {
      "main": [
        [
          {
            "node": "Tax Categorization Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Configuration": {
      "main": [
        [
          {
            "node": "Fetch Revenue Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anomaly Detection Agent": {
      "main": [
        [
          {
            "node": "Correction Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Weekly/Monthly Schedule": {
      "main": [
        [
          {
            "node": "Workflow Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Correction Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Correction Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Tax Categorization Agent": {
      "main": [
        [
          {
            "node": "Anomaly Detection Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Compliance Summary": {
      "main": [
        [
          {
            "node": "Send Summary to Tax Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Summary to Tax Agent": {
      "main": [
        [
          {
            "node": "Send WhatsApp Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sync to Accounting Software": {
      "main": [
        [
          {
            "node": "Format Compliance Summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Model - Correction": {
      "ai_languageModel": [
        [
          {
            "node": "Correction Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Categorization Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Tax Categorization Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Anomaly Detection Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Anomaly Detection Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Model - Categorization": {
      "ai_languageModel": [
        [
          {
            "node": "Tax Categorization Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Model - Anomaly Detection": {
      "ai_languageModel": [
        [
          {
            "node": "Anomaly Detection Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  }
}