{
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Send Shopify shipping tracking WhatsApp notifications with full tracking info",
    "wechat": "youandme10086",
    "id": 12078,
    "update_time": "2026-02-13"
  },
  "nodes": [
    {
      "id": "c7138ff9-2c46-4e55-bef7-19f466c5fd7d",
      "name": "Phone Validator",
      "type": "n8n-nodes-base.code",
      "position": [
        2064,
        1152
      ],
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Ù‚Ø§Ø¦Ù…Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¯ÙˆÙ„\nconst countryCodes = {\n  'OM': '968', 'JO': '962', 'AE': '971', 'SA': '966', 'KW': '965',\n  'QA': '974', 'BH': '973', 'EG': '20', 'IQ': '964', 'LB': '961',\n  'SY': '963', 'PS': '970', 'YE': '967', 'US': '1', 'GB': '44',\n  'DE': '49', 'FR': '33', 'IT': '39', 'ES': '34', 'TR': '90',\n  'IN': '91', 'PK': '92'\n};\n\n// Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† fulfilment trigger\nconst fulfillmentData = $('fulfilment').item.json;\n\nconst phone = fulfillmentData.destination?.phone ||\n              fulfillmentData.shipping_address?.phone ||\n              fulfillmentData.phone || \n              '';\n\nconst countryCode = fulfillmentData.destination?.country_code ||\n                    fulfillmentData.shipping_address?.country_code ||\n                    'OM';\n\n// ØªÙ†Ø¶ÙŠÙ Ø§Ù„Ø±Ù‚Ù…\nlet formattedPhone = phone.trim().replace(/\\s+/g, '').replace(/[^0-9+]/g, '');\n\n// Ù„Ùˆ Ø§Ù„Ø±Ù‚Ù… ÙØ§Ø¶ÙŠ\nif (!formattedPhone || formattedPhone.length < 5) {\n  return {\n    phone: phone,\n    original_phone: phone,\n    country_code: countryCode,\n    validation_status: 'empty_or_invalid'\n  };\n}\n\n// Ù†Ø´ÙŠÙƒ Ø¥Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø¨ÙŠØ¨Ø¯Ø£ Ø¨ÙƒÙˆØ¯ Ø¯ÙˆÙ„Ø©\nconst startsWithCode = Object.values(countryCodes).some(code => {\n  const cleanPhone = formattedPhone.replace('+', '');\n  return cleanPhone.startsWith(code);\n});\n\nif (!startsWithCode) {\n  // Ø§Ù„Ø±Ù‚Ù… Ù…Ø§ Ø¨ÙŠØ¨Ø¯Ø£ Ø¨ÙƒÙˆØ¯ - Ù†Ø¶ÙŠÙ Ø§Ù„ÙƒÙˆØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø¨Ù„Ø¯\n  const defaultCode = countryCodes[countryCode] || '968';\n  const cleanPhone = formattedPhone.replace('+', '');\n  formattedPhone = '+' + defaultCode + cleanPhone;\n} else if (!formattedPhone.startsWith('+')) {\n  // Ø§Ù„ÙƒÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø³ Ù…Ø§ ÙÙŠ Ø¹Ù„Ø§Ù…Ø© +\n  formattedPhone = '+' + formattedPhone;\n}\n\nreturn {\n  phone: formattedPhone,\n  original_phone: phone,\n  country_code: countryCode,\n  validation_status: 'success'\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "a65aa462-8570-4162-b5a0-63f533f69fa6",
      "name": "Update Order Shipped1",
      "type": "n8n-nodes-base.postgres",
      "position": [
        1632,
        1152
      ],
      "parameters": {
        "query": "UPDATE orders SET status = 'shipped', shipping_company = '{{ ($('fulfilment').item.json.tracking_company || '').replace(/'/g, \"''\") }}', tracking_number = '{{ $('fulfilment').item.json.tracking_number || '' }}' WHERE order_id = {{ $('fulfilment').item.json.order_id }} RETURNING customer_id",
        "options": {},
        "operation": "executeQuery"
      },
      "credentials": {
        "postgres": {
          "id": "credential-id",
          "name": "Postgres account"
        }
      },
      "typeVersion": 2
    },
    {
      "id": "2b0bb6ff-c294-46f8-b8cd-db64aaa22248",
      "name": "Select rows from a table6",
      "type": "n8n-nodes-base.postgres",
      "position": [
        1872,
        1152
      ],
      "parameters": {
        "limit": 1,
        "table": {
          "__rl": true,
          "mode": "list",
          "value": "customers",
          "cachedResultName": "customers"
        },
        "where": {
          "values": [
            {
              "value": "={{ $('fulfilment').item.json.destination.phone }}",
              "column": "phone"
            }
          ]
        },
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "options": {},
        "operation": "select"
      },
      "credentials": {
        "postgres": {
          "id": "credential-id",
          "name": "Postgres account"
        }
      },
      "typeVersion": 2.6
    },
    {
      "id": "fa7ad08f-3440-4c37-ae50-dcf3bf525aa2",
      "name": "Get Customer1",
      "type": "n8n-nodes-base.postgres",
      "position": [
        2256,
        1152
      ],
      "parameters": {
        "query": "SELECT phone, language, first_name FROM customers WHERE website_id = {{ $('Select rows from a table6').item.json.website_id }}",
        "options": {},
        "operation": "executeQuery"
      },
      "credentials": {
        "postgres": {
          "id": "credential-id",
          "name": "Postgres account"
        }
      },
      "typeVersion": 2
    },
    {
      "id": "5f221872-1c2e-4f0e-90f0-d1fd83b4b142",
      "name": "Check Language",
      "type": "n8n-nodes-base.if",
      "position": [
        2464,
        1152
      ],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ ($('Get Customer1').item.json.language || 'en').trim().substring(0, 2) }}",
              "value2": "ar"
            }
          ]
        }
      },
      "typeVersion": 1
    },
    {
      "id": "a95ed7ff-3755-4f60-bc45-757436a953b5",
      "name": "If10",
      "type": "n8n-nodes-base.if",
      "position": [
        2672,
        960
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 3,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "4e62f9c7-e498-4f22-8b94-2d9d2f72a806",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $('Phone Validator').item.json.phone }}",
              "rightValue": "=+96897666604"
            },
            {
              "id": "fe42ee4c-90fa-4daa-a7fb-be978382acb7",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $('Phone Validator').item.json.phone }}",
              "rightValue": "+1234567890"
            }
          ]
        }
      },
      "typeVersion": 2.3
    },
    {
      "id": "b63cc981-23db-413b-82ce-368981374730",
      "name": "If11",
      "type": "n8n-nodes-base.if",
      "position": [
        2672,
        1344
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 3,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "4e62f9c7-e498-4f22-8b94-2d9d2f72a806",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $('Phone Validator').item.json.phone }}",
              "rightValue": "=+96897666604"
            },
            {
              "id": "fe42ee4c-90fa-4daa-a7fb-be978382acb7",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $('Phone Validator').item.json.phone }}",
              "rightValue": "+1234567890"
            }
          ]
        }
      },
      "typeVersion": 2.3
    },
    {
      "id": "431ba0fb-59f1-43c9-80f4-239525e516d2",
      "name": "WhatsApp Shipped AR",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2912,
        944
      ],
      "parameters": {
        "url": "https://graph.facebook.com/v18.0/819420977915834/messages",
        "method": "POST",
        "options": {},
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $('Phone Validator').item.json.phone.replace('+', '') }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Ù…Ø±Ø­Ø¨Ù‹Ø§ {{ $('Get Customer1').item.json.first_name }}ØŒ\\n\\nÙŠØ³Ø±Ù‘Ù†Ø§ Ø¥Ø¹Ù„Ø§Ù…ÙƒÙ… Ø¨Ø£Ù†Ù‡ ØªÙ… Ø´Ø­Ù† Ø·Ù„Ø¨ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­.\\nØ±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: {{ $('fulfilment').item.json.order_id }}\\nØ±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹: {{ $('fulfilment').item.json.tracking_number }}\\nØ´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†: {{ $('fulfilment').item.json.tracking_company }}\\nØ±Ø§Ø¨Ø· Ø§Ù„ØªØªØ¨Ø¹ : {{ $('fulfilment').item.json.tracking_url }}\\nØ§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„Ù„ØªÙˆØµÙŠÙ„: Ù…Ù† 7 Ø¥Ù„Ù‰ 12 ÙŠÙˆÙ… Ø¹Ù…Ù„.\\n\\nÙŠÙ…ÙƒÙ†ÙƒÙ… Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø© Ø¹Ø¨Ø± Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ØŒ ÙˆØ³Ù†Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø¥Ø¨Ù‚Ø§Ø¦ÙƒÙ… Ø¹Ù„Ù‰ Ø§Ø·Ù„Ø§Ø¹ Ø­ØªÙ‰ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.\\nÙ†Ø´ÙƒØ±ÙƒÙ… Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒÙ… Ø¨Ø¹ÙÙ…Ø§Ù† Ù„Ø§ÙƒØ¬Ø±ÙŠ.\\n\\nÙ…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªØ­ÙŠØ§ØªØŒ\\nØ¹ÙÙ…Ø§Ù† Ù„Ø§ÙƒØ¬Ø±ÙŠ\"\n  }\n}",
        "sendBody": true,
        "specifyBody": "json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth"
      },
      "credentials": {
        "httpBearerAuth": {
          "id": "credential-id",
          "name": "whatsapp"
        }
      },
      "typeVersion": 4
    },
    {
      "id": "6d6fac70-72c3-4c35-9291-11e0b63bd4dd",
      "name": "WhatsApp Shipped EN1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2912,
        1328
      ],
      "parameters": {
        "url": "https://graph.facebook.com/v18.0/819420977915834/messages",
        "method": "POST",
        "options": {},
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $('Phone Validator').item.json.phone.replace('+', '') }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Hello {{ $('Get Customer1').item.json.first_name }},\\n\\nWe are pleased to inform you that your order has been shipped successfully.\\n\\nOrder No: {{ $('fulfilment').item.json.order_id }}\\nTracking No: {{ $('fulfilment').item.json.tracking_number }}\\nCourier Company: {{ $('fulfilment').item.json.tracking_company }}\\nTracking Url: {{ $('fulfilment').item.json.tracking_url }}\\nEstimated delivery time: 7â€“12 business days.\\n\\nYou may track your shipment using the tracking number provided. We will continue to keep you informed until your order is delivered.\\nT  }\n}",
        "sendBody": true,
        "specifyBody": "json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth"
      },
      "credentials": {
        "httpBearerAuth": {
          "id": "credential-id",
          "name": "whatsapp"
        }
      },
      "typeVersion": 4
    },
    {
      "id": "8ba4a7f3-90d8-4a9f-81d5-6c0aba6b5cc2",
      "name": "fulfilment",
      "type": "n8n-nodes-base.shopifyTrigger",
      "position": [
        1472,
        1152
      ],
      "webhookId": "5d5fab2e-489f-4401-bd9a-d2b70e511d5d",
      "parameters": {
        "topic": "fulfillments/create",
        "authentication": "accessToken"
      },
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "credential-id",
          "name": "oman account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "474ccf63-f94e-40e6-bc63-b41448e7c222",
      "name": "Sticky Note15",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        736,
        320
      ],
      "parameters": {
        "width": 560,
        "height": 1744,
        "content": "---\n\n## ğŸ¯ Key Features\n- âœ… **Real-time Fulfillment Sync:** Instant database update when order ships\n- âœ… **Complete Tracking Info:** Includes tracking number, company, and URL\n- âœ… **Bilingual Support:** Auto-detects customer language preference from database\n- âœ… **Phone Validation:** Handles 23+ country codes with auto-formatting\n- âœ… **Test Protection:** Prevents notifications to development numbers\n- âœ… **Personalization:** Uses customer first name in greeting\n- âœ… **Delivery Expectations:** Sets clear 7-12 day timeline\n- âœ… **Professional Branding:** Luxury brand tone in both languages\n- âœ… **Trackable Links:** Includes clickable tracking URL\n\n---\n\n## ğŸ“Š Database Operations\n\n### **Orders Table Update**\n- **Status Change:** 'open/paid' â†’ 'shipped'\n- **New Fields Added:**\n  - shipping_company: Courier service name\n  - tracking_number: Package tracking ID\n- **Lookup Key:** order_id (from Shopify)\n- **Returns:** customer_id for subsequent queries\n\n### **Customers Table Query**\n- **Lookup:** By website_id (Shopify customer ID)\n- **Retrieved:** phone, language, first_name\n- **Purpose:** Get communication preferences\n\n---\n\n## ğŸ“ Technical Details\n- **WhatsApp API Version:** v18.0\n- **API Endpoint:** graph.facebook.com/v18.0/819420977915834/messages\n- **Authentication:** Bearer YOUR_TOKEN_HERE (credential: \"whatsapp mira\")\n- **Phone Format:** International format with country code (+CountryCode + Number)\n- **API Phone Format:** Removes '+' before sending to WhatsApp API\n- **Database:** PostgreSQL\n- **Credential Name:** \"Postgres account\"\n- **Default Country:** Oman (+968) if country_code not detected\n- **Test Numbers Blocked:** \n  - +96897666604 (Oman)\n  - +962798087441 (Jordan)\n\n---\n\n## ğŸ”„ Data Flow Summary\n1. **Fulfillment created** â†’ Shopify webhook fires\n2. **Update order status** â†’ Mark as 'shipped' with tracking details\n3. **Lookup customer** â†’ Find by phone from fulfillment data\n4. **Validate phone** â†’ Format with country code\n5. **Get preferences** â†’ Retrieve language and name from database\n6. **Detect language** â†’ Route to AR or EN path\n7. **Filter tests** â†’ Skip internal phone numbers\n8. **Send notification** â†’ WhatsApp message with tracking info\n\n---\n\n## ğŸ’¼ Business Logic\n- **Delivery Window:** Consistently communicates 7-12 business days\n- **Brand Voice:** Professional luxury brand tone\n- **Customer Service:** Proactive communication at shipping milestone\n- **Tracking Empowerment:** Provides all tools for self-service tracking\n- **Multi-channel Sync:** Database, Shopify, and WhatsApp aligned\n\n---\n\n## ğŸŒ Multi-language Support\n| Element | Arabic | English |\n|---------|--------|---------|\n| Greeting | Ù…Ø±Ø­Ø¨Ù‹Ø§ | Hello |\n| Status | ØªÙ… Ø´Ø­Ù† Ø·Ù„Ø¨ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­ | Successfully shipped |\n| Order No | Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ | Order No |\n| Tracking No | Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ | Tracking No |\n| Courier | Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù† | Courier Company |\n| Delivery | Ù…Ù† 7 Ø¥Ù„Ù‰ 12 ÙŠÙˆÙ… Ø¹Ù…Ù„ | 7â€“12 business days |\n"
      },
      "typeVersion": 1
    },
    {
      "id": "a2592b35-7df6-48c8-b193-48483233cc50",
      "name": "Sticky Note18",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3168,
        832
      ],
      "parameters": {
        "color": 6,
        "width": 672,
        "height": 864,
        "content": "\n### **8A. Arabic Shipping Notification - \"WhatsApp Shipped AR\"**\n- **Type:** HTTP Request (POST)\n- **Endpoint:** Facebook Graph API v18.0 (WhatsApp Business)\n- **Phone Format:** Removes '+' prefix before API call\n- **Message Content (Arabic):**\n  - **Greeting:** \"Ù…Ø±Ø­Ø¨Ù‹Ø§ [first_name]\" (Hello)\n  - **Status:** \"ØªÙ… Ø´Ø­Ù† Ø·Ù„Ø¨ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­\" (Your order has been shipped successfully)\n  - **Order Details:**\n    - Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (Order No): order_id\n    - Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ (Tracking No): tracking_number\n    - Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù† (Courier): tracking_company\n    - Ø±Ø§Ø¨Ø· Ø§Ù„ØªØªØ¨Ø¹ (Tracking URL): tracking_url\n  - **Delivery Time:** 7-12 business days (in Arabic)\n  - **Instructions:** Can track via tracking number\n- **Tone:** Formal, professional Arabic suitable for luxury brand\n- **Purpose:** Send comprehensive shipping notification to Arabic-speaking customers\n\n---\n\n### **8B. English Shipping Notification - \"WhatsApp Shipped EN1\"**\n- **Type:** HTTP Request (POST)\n- **Endpoint:** Same WhatsApp Business API\n- **Phone Format:** Removes '+' prefix\n- **Message Content (English):**\n  - **Greeting:** \"Hello [first_name]\"\n  - **Status:** \"Your order has been shipped successfully\"\n  - **Order Details:**\n    - Order No: order_id\n    - Tracking No: tracking_number\n    - Courier Company: tracking_company\n    - Tracking URL: tracking_url\n  - **Delivery Time:** 7-12 business days\n  - **Instructions:** Track shipment using tracking number\n  \"\n- **Tone:** Professional, informative English\n- **Purpose:** Send comprehensive shipping notification to English-speaking customers\n\n"
      },
      "typeVersion": 1
    }
  ],
  "pinData": {},
  "connections": {
    "If10": {
      "main": [
        [
          {
            "node": "WhatsApp Shipped AR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If11": {
      "main": [
        [
          {
            "node": "WhatsApp Shipped EN1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fulfilment": {
      "main": [
        [
          {
            "node": "Update Order Shipped1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Customer1": {
      "main": [
        [
          {
            "node": "Check Language",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Language": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Phone Validator": {
      "main": [
        [
          {
            "node": "Get Customer1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Order Shipped1": {
      "main": [
        [
          {
            "node": "Select rows from a table6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table6": {
      "main": [
        [
          {
            "node": "Phone Validator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}