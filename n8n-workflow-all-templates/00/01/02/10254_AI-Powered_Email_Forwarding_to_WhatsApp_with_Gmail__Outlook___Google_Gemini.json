{
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "AI-Powered Email Forwarding to WhatsApp with Gmail, Outlook & Google Gemini",
    "wechat": "youandme10086",
    "id": 10254,
    "update_time": "2025-11-10"
  },
  "name": "Email to WhatsApp - AI Multi-Account Bridge",
  "tags": [
    {
      "id": "jI0BIUFr6PMyBv84",
      "name": "email-automation",
      "createdAt": "2025-10-13T20:32:05.900Z",
      "updatedAt": "2025-10-13T20:32:05.900Z"
    },
    {
      "id": "rxgkgqJKF9XaNJW5",
      "name": "inbox-forwarding",
      "createdAt": "2025-10-13T20:50:58.294Z",
      "updatedAt": "2025-10-13T20:50:58.294Z"
    }
  ],
  "nodes": [
    {
      "id": "a4fcf610-1624-4966-82ee-85c51f67ab77",
      "name": "Mark as Read (Gmail)",
      "type": "n8n-nodes-base.gmail",
      "position": [
        1216,
        -16
      ],
      "webhookId": "b10aa89f-b663-4677-81df-6061a0530411",
      "parameters": {
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "operation": "markAsRead"
      },
      "credentials": {
        "gmailOAuth2": {
          "name": "Gmail OAuth2 Account"
        }
      },
      "typeVersion": 2.1
    },
    {
      "id": "b02ca228-1a77-4425-b49b-8a90edf0bc85",
      "name": "Filter & Format Email (Gmail)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        640,
        128
      ],
      "parameters": {
        "text": "=You are an email formatter. Here is the cleaned email data:\n\nFrom: {{ $json.from }}\nSubject: {{ $json.subject }}\nDate: {{ $json.date }}\nBody:\n{{ $json.body }}\n\nTask: Format this exactly as a WhatsApp message with no code fences, JSON, or extra characters. Output only the message text:\n\n*â”â”â” ğŸ“¬ New Email â”â”â”*\nğŸ‘¤ {{ $json.from }}\nğŸ“‹ {{ $json.subject }}\nğŸ• {{ $json.date }}\n\n{{ $json.body }}\n\n*â”â”â”â”â”â”â”â”â”â”â”â”*",
        "options": {
          "systemMessage": "Ù„Ø§ ØªÙ†Ø³Ù‰ Ø§Ù† Ù‚ÙˆÙ… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙƒØ§Ù…Ù„ Ù…Ø¹ ØªÙˆÙÙŠØ± Ø±ÙˆØ§Ø¨Ø· Urls Ø§Ù† ÙˆØ¬Ø¯Øª Ø®ØµÙˆØµØ§ Ø¨Ø¹Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªØªØ·Ù„Ø¨ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ± Ù ÙƒÙ„ Ù…Ø§Ø¹Ù„ÙŠÙƒ Ù‡Ùˆ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù†Ù‡Ø§ ÙˆÙƒØ°Ù„Ùƒ ÙƒÙ„ Ù…Ø§Ø¹Ù„ÙŠÙƒ Ù‡Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù„ØºØªÙ‡Ø§ ÙˆØ³ÙˆÙ ÙŠØªÙ… ØªØ±Ø¬Ù…ØªÙ‡Ø§ Ø¨Ø¹Ø¯Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©\nÙ‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ ÙƒÙ„ Ù…Ø§ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ùˆ Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ùˆ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø®Ø·ÙˆØªÙŠÙ† ÙˆØºÙŠØ±Ù‡Ù… ÙˆÙ„ÙƒÙ† Ø§Ù„Ø§Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø²Ø¹Ø¬Ø© Ù‚Ù… Ø¨ØªØ®Ø·ÙŠÙ‡Ø§ ÙˆØ§Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø±Ø³Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù‚Ù… Ø¨Ø§Ø´Ø¹Ø§Ø±ÙŠ Ø§Ù†Ù‡ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ù‡ Ø¬Ø¯ÙŠØ¯Ù‡ Ù„Ø§ ØªÙ‚Ù… Ø¨ØªÙƒØ±Ø§Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù†ÙØ³Ù‡Ø§ ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©\nâœ… ALWAYS FORWARD (Any Sender):\n\nAccount activation emails\n\n2FA codes & security alerts\n\nCritical system notifications\n\nUrgent security warnings\n\nPassword reset requests\nâœ… APPROVED SENDERS SPECIAL ACCESS:\n\n# REPLACE THESE WITH YOUR TRUSTED EMAIL ADDRESSES:\nyour-trusted-email@example.com\nyour-trusted-email@example.com\nyour-trusted-email@example.com\n\nFrom approved senders ONLY, also forward:\n\nInformal greetings (Ù‡Ù„Ø§, Ø§Ù„Ø³Ù„Ø§Ù…, etc.)\n\nPersonal conversations\n\nNon-urgent communications\n\nâŒ IGNORE COMPLETELY:\n\nPromotions & marketing\n\nNewsletters\n\nSocial media notifications\n\nAdvertisement emails\nğŸ“§ EMAIL MANAGEMENT PERMISSIONS\nDelete all messages from Spam folder\n\nDelete all messages from Drafts folder\n\nEmpty Trash folder completely\n\nAutomatic cleanup of non-essential folders\nØ§Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙØ±Ù†Ø³ÙŠØ© Ø§Ùˆ Ø§ÙŠØ© Ù„ØºØ© Ø§Ø®Ø±Ù‰ Ù‚Ù… Ø¨ØªØ±Ø¬Ù…ØªÙ‡Ø§ ÙÙˆØ±Ø§Ù‹ Ø§Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¯ÙˆÙ† Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø§ØµÙ„\nÙ„Ø§ ØªÙ‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø¨ÙŠÙ†ØªØ±Ø³Øª"
        },
        "promptType": "define"
      },
      "typeVersion": 2.2
    },
    {
      "id": "a88ba984-3fda-4915-a4b5-51be459d891d",
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        640,
        288
      ],
      "parameters": {
        "options": {}
      },
      "credentials": {
        "googlePalmApi": {
          "name": "Google Gemini API Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "19fd23b5-1cbe-43e2-8373-00a082f096cd",
      "name": "Parse Gmail Data",
      "type": "n8n-nodes-base.code",
      "position": [
        272,
        128
      ],
      "parameters": {
        "jsCode": "// Get the first email object from the trigger array\nconst emailArray = $input.all();\nif (!emailArray.length) throw new Error('No email data received');\nconst email = emailArray[0].json;\n\n// Helper to collect all body parts recursively\nfunction collectBodies(parts) {\n  let bodies = [];\n  for (const part of parts) {\n    if (part.mimeType === 'text/plain' && part.body?.data) {\n      bodies.push(Buffer.from(part.body.data, 'base64').toString('utf-8'));\n    }\n    if (part.mimeType === 'text/html' && part.body?.data) {\n      // Optionally strip HTML tags here, or leave for the AI\n      bodies.push(Buffer.from(part.body.data, 'base64').toString('utf-8'));\n    }\n    if (part.parts) {\n      bodies = bodies.concat(collectBodies(part.parts));\n    }\n  }\n  return bodies;\n}\n\n// Build the full body string\nlet body = '';\nif (email.payload?.parts) {\n  const parts = collectBodies(email.payload.parts);\n  body = parts.join('\\n\\n').trim();\n}\nif (!body && email.text) body = email.text;\nif (!body && email.textAsHtml) body = email.textAsHtml.replace(/<[^>]+>/g, '\\n');\nif (!body && email.snippet) body = email.snippet;\nif (!body) body = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø±Ø³Ø§Ø¦Ù„';\n\n// Extract the Date header value\nconst rawDate = email.headers?.date?.replace(/^Date:\\s*/, '') || email.date;\nconst date = new Date(rawDate).toLocaleString('ar-SA', {\n  year: 'numeric',\n  month: 'long',\n  day: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit'\n});\n\n// Return simplified JSON for downstream nodes\nreturn [\n  {\n    json: {\n      from: `${email.from.value[0]?.name || 'ØºÙŠØ± Ù…Ø¹Ù„ÙˆÙ…'} <${email.from.value[0]?.address || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}>`,\n      subject: email.subject,\n      date: date,\n      body: body\n    }\n  }\n];\n"
      },
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "id": "7d4fb53a-d9b9-4926-a31e-43e2fddffc58",
      "name": "Send to WhatsApp (Gmail)",
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "position": [
        1216,
        112
      ],
      "parameters": {
        "resource": "messages-api",
        "remoteJid": "YOUR_WHATSAPP_NUMBER@s.whatsapp.net",
        "messageText": "={{ $json.output }}",
        "instanceName": "YourInstanceName",
        "options_message": {}
      },
      "credentials": {
        "evolutionApi": {
          "name": "Evolution API Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "015bf9ca-42dc-4f5f-a7aa-60dbc0a0c2a9",
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "position": [
        -16,
        128
      ],
      "parameters": {
        "simple": false,
        "filters": {},
        "options": {},
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      },
      "credentials": {
        "gmailOAuth2": {
          "name": "Gmail OAuth2 Account"
        }
      },
      "typeVersion": 1.3
    },
    {
      "id": "52a45c12-271f-4592-91f1-0a3f9f47b3a7",
      "name": "Filter & Format Email (Outlook Personal)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        640,
        432
      ],
      "parameters": {
        "text": "=You are an email formatter. Here is the cleaned email data:\n\nFrom: {{ $json.from }}\nSubject: {{ $json.subject }}\nDate: {{ $json.date }}\nBody:\n{{ $json.body }}\n\nTask: Format this exactly as a WhatsApp message with no code fences, JSON, or extra characters. Output only the message text:\n\n*â”â”â” ğŸ“¬ New Outlook Email â”â”â”*\nğŸ‘¤ {{ $json.from }}\nğŸ“‹ {{ $json.subject }}\nğŸ• {{ $json.date }}\n\n{{ $json.body }}\n\n*â”â”â”â”â”â”â”â”â”â”â”â”*",
        "options": {
          "systemMessage": "You are an email-forwarding assistant. Produce only the WhatsApp message text (no JSON, no code, no comments).\n\nINPUT:\n- from, subject, date, classification (\"focused\"/\"other\"), body, id, rawHtml.\n\nRULES (in order):\n1. **ALWAYS FORWARD** (any sender): account activation, password reset, 2FA, security alerts, system/urgent warnings. Include full content + all links.\n2. **APPROVED SENDERS** (forward all, even casual):\n# REPLACE THESE WITH YOUR TRUSTED EMAIL ADDRESSES:\n   - your-trusted-email@example.com\n   - your-trusted-email@example.com\n   - your-trusted-email@example.com\n   - your-trusted-email@example.com\n3. **IGNORE**: ads, promotions, newsletters, social notifications, Pinterest.\n4. **DUPLICATES** (same id/body): output only â†’ âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©\n\nLINKS:\n- Extract all URLs from body & rawHtml (`http`, `href`, `src`).\n- Show under `ğŸ”— Links found:` each on new line.\n- Prioritize activation/reset/verify links first.\n- If none, still show header.\n\nLANGUAGE:\n- Arabic/English â†’ send as-is.\n- Other languages â†’ translate full body to Arabic only (no original text), wrap with RTL markers (U+202B ... U+202C).\n\nFORMAT (WhatsApp message):\n*â”â”â” ğŸ“¬ New Outlook Email â”â”â”*\nğŸ‘¤ {{from}}\nğŸ“‹ {{subject}}\nğŸ• {{date}}\nğŸ“‚ Category: {{classificationCapitalized}}\n\n{{body}}\n\nğŸ”— Links found:\nhttps://...\n\n*â”â”â”â”â”â”â”â”â”â”â”â”*\n\nOTHER RULES:\n- Keep all numbers/codes exactly.\n- No Pinterest or spam messages ever.\n- If activation/verify email has no link â†’ forward full body anyway.\n- Only output the formatted WhatsApp message (no extra text, no JSON).\n\nIf duplicate â†’ âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø© only.\n"
        },
        "promptType": "define"
      },
      "typeVersion": 2.2
    },
    {
      "id": "7aa39c16-4b4a-43be-ae36-5098d28ebe13",
      "name": "Google Gemini Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        640,
        592
      ],
      "parameters": {
        "options": {}
      },
      "credentials": {
        "googlePalmApi": {
          "name": "Google Gemini API Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "8c7582a2-2e1b-45e9-9da5-ed95a6e03210",
      "name": "Parse Outlook Personal Data",
      "type": "n8n-nodes-base.code",
      "position": [
        352,
        432
      ],
      "parameters": {
        "jsCode": "// ğŸ“¨ Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Outlook Trigger\nconst emailArray = $input.all();\nif (!emailArray.length) throw new Error('No email data received');\nconst email = emailArray[0].json;\n\n// ğŸ§© Decode HTML entities\nfunction decodeHtmlEntities(text) {\n  if (!text) return '';\n  const entities = {\n    '&nbsp;': ' ',\n    '&amp;': '&',\n    '&quot;': '\"',\n    ''': \"'\",\n    '&lt;': '<',\n    '&gt;': '>',\n  };\n  return text.replace(/&[a-z#0-9]+;/gi, m => entities[m] || m);\n}\n\n// ğŸ“¨ Extract and clean body\nlet body = '';\nif (email.body?.content) {\n  if (email.body.contentType === 'html') {\n    body = decodeHtmlEntities(\n      email.body.content\n        .replace(/<style[\\s\\S]*?<\\/style>/gi, '')\n        .replace(/<script[\\s\\S]*?<\\/script>/gi, '')\n        .replace(/<[^>]+>/g, '\\n')\n        .replace(/\\n\\s*\\n+/g, '\\n')\n        .replace(/\\s{2,}/g, ' ')\n        .replace(/\\u200B/g, '')\n        .trim()\n    );\n  } else {\n    body = decodeHtmlEntities(email.body.content.trim());\n  }\n}\nif (!body && email.bodyPreview) body = decodeHtmlEntities(email.bodyPreview);\nif (!body) body = 'No message content found';\n\n// ğŸ§  Classification\nconst classification = email.inferenceClassification?.toLowerCase() || 'other';\nconst categoryLine = `ğŸ“‚ Category: ${classification.charAt(0).toUpperCase() + classification.slice(1)}`;\n\n// ğŸ—“ï¸ Format date\nconst date = email.receivedDateTime\n  ? new Date(email.receivedDateTime).toLocaleString('ar-SA', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    })\n  : 'Unknown date';\n\n// âœ… Output simplified JSON\nreturn [\n  {\n    json: {\n      id: email.id,\n      from: `${email.from?.emailAddress?.name || 'Unknown'} <${email.from?.emailAddress?.address || 'Unknown'}>`,\n      subject: email.subject || 'No Subject',\n      date,\n      classification,\n      body: `${categoryLine}\\n\\n${body}`,\n      rawHtml: email.body?.contentType === 'html' ? email.body.content : ''\n    }\n  }\n];\n"
      },
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "id": "2bdfebb3-4f9e-4fd3-a721-74ea8cfe8556",
      "name": "Send to WhatsApp (Outlook Personal)",
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "position": [
        1168,
        432
      ],
      "parameters": {
        "resource": "messages-api",
        "remoteJid": "YOUR_WHATSAPP_NUMBER@s.whatsapp.net",
        "messageText": "={{ $json.output }}",
        "instanceName": "YourInstanceName",
        "options_message": {}
      },
      "credentials": {
        "evolutionApi": {
          "name": "Evolution API Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "9ee77eed-b447-441d-9ad8-eec3850591db",
      "name": "Microsoft Outlook Trigger",
      "type": "n8n-nodes-base.microsoftOutlookTrigger",
      "position": [
        0,
        432
      ],
      "parameters": {
        "output": "raw",
        "filters": {},
        "options": {},
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      },
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "name": "Microsoft Outlook OAuth2 Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "84113157-9f7c-4138-81f7-fc9b767afbe1",
      "name": "Filter & Format Email (Outlook Business)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        640,
        720
      ],
      "parameters": {
        "text": "=You are an email formatter. Here is the cleaned email data:\n\nFrom: {{ $json.from }}\nSubject: {{ $json.subject }}\nDate: {{ $json.date }}\nBody:\n{{ $json.body }}\n\nTask: Format this exactly as a WhatsApp message with no code fences, JSON, or extra characters. Output only the message text:\n\n*â”â”â” ğŸ“¬ New Outlook Email â”â”â”*\nğŸ‘¤ {{ $json.from }}\nğŸ“‹ {{ $json.subject }}\nğŸ• {{ $json.date }}\n\n{{ $json.body }}\n\n*â”â”â”â”â”â”â”â”â”â”â”â”*",
        "options": {
          "systemMessage": "You are an email-forwarding assistant. Produce only the WhatsApp message text (no JSON, no code, no comments).\n\nINPUT:\n- from, subject, date, classification (\"focused\"/\"other\"), body, id, rawHtml.\n\nRULES (in order):\n1. **ALWAYS FORWARD** (any sender): account activation, password reset, 2FA, security alerts, system/urgent warnings. Include full content + all links.\n2. **APPROVED SENDERS** (forward all, even casual):\n# REPLACE THESE WITH YOUR TRUSTED EMAIL ADDRESSES:\n   - your-trusted-email@example.com\n   - your-trusted-email@example.com\n   - your-trusted-email@example.com\n   - your-trusted-email@example.com\n3. **IGNORE**: ads, promotions, newsletters, social notifications, Pinterest.\n4. **DUPLICATES** (same id/body): output only â†’ âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©\n\nLINKS:\n- Extract all URLs from body & rawHtml (`http`, `href`, `src`).\n- Show under `ğŸ”— Links found:` each on new line.\n- Prioritize activation/reset/verify links first.\n- If none, still show header.\n\nLANGUAGE:\n- Arabic/English â†’ send as-is.\n- Other languages â†’ translate full body to Arabic only (no original text), wrap with RTL markers (U+202B ... U+202C).\n\nFORMAT (WhatsApp message):\n*â”â”â” ğŸ“¬ New Outlook Email â”â”â”*\nğŸ‘¤ {{from}}\nğŸ“‹ {{subject}}\nğŸ• {{date}}\nğŸ“‚ Category: {{classificationCapitalized}}\n\n{{body}}\n\nğŸ”— Links found:\nhttps://...\n\n*â”â”â”â”â”â”â”â”â”â”â”â”*\n\nOTHER RULES:\n- Keep all numbers/codes exactly.\n- No Pinterest or spam messages ever.\n- If activation/verify email has no link â†’ forward full body anyway.\n- Only output the formatted WhatsApp message (no extra text, no JSON).\n\nIf duplicate â†’ âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø© only.\n"
        },
        "promptType": "define"
      },
      "typeVersion": 2.2
    },
    {
      "id": "a08000de-0200-446c-9d02-94709c956215",
      "name": "Google Gemini Chat Model3",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        640,
        864
      ],
      "parameters": {
        "options": {}
      },
      "credentials": {
        "googlePalmApi": {
          "name": "Google Gemini API Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "9f2e63ba-5271-4637-a414-f13bbbc50b92",
      "name": "Parse Outlook Business Data",
      "type": "n8n-nodes-base.code",
      "position": [
        336,
        720
      ],
      "parameters": {
        "jsCode": "// ğŸ“¨ Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Outlook Trigger\nconst emailArray = $input.all();\nif (!emailArray.length) throw new Error('No email data received');\nconst email = emailArray[0].json;\n\n// ğŸ§© Decode HTML entities\nfunction decodeHtmlEntities(text) {\n  if (!text) return '';\n  const entities = {\n    '&nbsp;': ' ',\n    '&amp;': '&',\n    '&quot;': '\"',\n    ''': \"'\",\n    '&lt;': '<',\n    '&gt;': '>',\n  };\n  return text.replace(/&[a-z#0-9]+;/gi, m => entities[m] || m);\n}\n\n// ğŸ“¨ Extract and clean body\nlet body = '';\nif (email.body?.content) {\n  if (email.body.contentType === 'html') {\n    body = decodeHtmlEntities(\n      email.body.content\n        .replace(/<style[\\s\\S]*?<\\/style>/gi, '')\n        .replace(/<script[\\s\\S]*?<\\/script>/gi, '')\n        .replace(/<[^>]+>/g, '\\n')\n        .replace(/\\n\\s*\\n+/g, '\\n')\n        .replace(/\\s{2,}/g, ' ')\n        .replace(/\\u200B/g, '')\n        .trim()\n    );\n  } else {\n    body = decodeHtmlEntities(email.body.content.trim());\n  }\n}\nif (!body && email.bodyPreview) body = decodeHtmlEntities(email.bodyPreview);\nif (!body) body = 'No message content found';\n\n// ğŸ§  Classification\nconst classification = email.inferenceClassification?.toLowerCase() || 'other';\nconst categoryLine = `ğŸ“‚ Category: ${classification.charAt(0).toUpperCase() + classification.slice(1)}`;\n\n// ğŸ—“ï¸ Format date\nconst date = email.receivedDateTime\n  ? new Date(email.receivedDateTime).toLocaleString('ar-SA', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    })\n  : 'Unknown date';\n\n// âœ… Output simplified JSON\nreturn [\n  {\n    json: {\n      id: email.id,\n      from: `${email.from?.emailAddress?.name || 'Unknown'} <${email.from?.emailAddress?.address || 'Unknown'}>`,\n      subject: email.subject || 'No Subject',\n      date,\n      classification,\n      body: `${categoryLine}\\n\\n${body}`,\n      rawHtml: email.body?.contentType === 'html' ? email.body.content : ''\n    }\n  }\n];\n"
      },
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "id": "59be9e86-117b-4e64-82ed-0ff4d7f90432",
      "name": "Send to WhatsApp (Outlook Business)",
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "position": [
        1200,
        720
      ],
      "parameters": {
        "resource": "messages-api",
        "remoteJid": "YOUR_BUSINESS_WHATSAPP@s.whatsapp.net",
        "messageText": "={{ $json.output }}",
        "instanceName": "YourInstanceName",
        "options_message": {}
      },
      "credentials": {
        "evolutionApi": {
          "name": "Evolution API Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "b456d602-7144-4d30-bff6-a0760b93c74d",
      "name": "Microsoft Outlook Trigger1",
      "type": "n8n-nodes-base.microsoftOutlookTrigger",
      "position": [
        -16,
        720
      ],
      "parameters": {
        "output": "raw",
        "filters": {},
        "options": {},
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      },
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "name": "Microsoft Outlook OAuth2 Account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "88861f50-f36a-4dc5-9753-30830df1e4b9",
      "name": "Mark as Read (Outlook Business)",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        160,
        720
      ],
      "parameters": {
        "url": "=https://graph.microsoft.com/v1.0/me/messages/{{$json[\"id\"]}}",
        "method": "PATCH",
        "options": {},
        "jsonBody": "{\n  \"isRead\": true\n}\n",
        "sendBody": true,
        "jsonHeaders": "={\n  \"Content-Type\": \"application/json\"\n}\n",
        "sendHeaders": true,
        "specifyBody": "json",
        "authentication": "predefinedCredentialType",
        "specifyHeaders": "json",
        "nodeCredentialType": "microsoftOutlookOAuth2Api"
      },
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "name": "Microsoft Outlook OAuth2 Account"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "87cbb822-ad87-4f49-89fc-fdc7376552e6",
      "name": "Mark as Read (Outlook Personal)",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        176,
        432
      ],
      "parameters": {
        "url": "=https://graph.microsoft.com/v1.0/me/messages/{{$json[\"id\"]}}",
        "method": "PATCH",
        "options": {},
        "jsonBody": "{\n  \"isRead\": true\n}\n",
        "sendBody": true,
        "jsonHeaders": "={\n  \"Content-Type\": \"application/json\"\n}\n",
        "sendHeaders": true,
        "specifyBody": "json",
        "authentication": "predefinedCredentialType",
        "specifyHeaders": "json",
        "nodeCredentialType": "microsoftOutlookOAuth2Api"
      },
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "name": "Microsoft Outlook OAuth2 Account"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "c7d231b7-4959-4588-afd9-15e661a4843c",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -48,
        -384
      ],
      "parameters": {
        "width": 1376,
        "height": 1616,
        "content": "ğŸ“§ EMAIL TO WHATSAPP AUTOMATION\n================================\nAI-powered multi-account email forwarding to WhatsApp\n\nğŸš€ FEATURES:\nâ€¢ Gmail + 2 Outlook accounts\nâ€¢ AI filtering with Google Gemini  \nâ€¢ Automatic Arabic translation\nâ€¢ Security email prioritization\nâ€¢ Spam filtering\n\nâš™ï¸ SETUP REQUIRED:\n1. Add 4 credentials (Gmail, Outlook, Gemini, Evolution API)\n2. Update WhatsApp numbers in send nodes\n3. Replace \"YourInstanceName\" with your Evolution API instance\n4. Customize approved emails in AI Agent prompts\n"
      },
      "typeVersion": 1
    },
    {
      "id": "6aacb364-caab-41a2-85b7-5e85c15783b8",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -592,
        128
      ],
      "parameters": {
        "width": 544,
        "height": 176,
        "content": "ğŸ“¬ GMAIL â†’ WHATSAPP\n===================\nMonitors Gmail â†’ AI filters â†’ Sends to WhatsApp\n\nSetup:\nâ€¢ Gmail OAuth2 credential\nâ€¢ Update phone in \"Send to WhatsApp (Gmail)\" node\n"
      },
      "typeVersion": 1
    },
    {
      "id": "4a0d060f-bd4e-4538-89cf-04890dd28ccc",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -592,
        432
      ],
      "parameters": {
        "width": 544,
        "height": 208,
        "content": "ğŸ“¬ OUTLOOK PERSONAL â†’ WHATSAPP\n==============================\nMonitors personal account\n\nSetup:\nâ€¢ Same Outlook credential\nâ€¢ Update phone in \"Send to WhatsApp (Outlook Personal)\" node\n"
      },
      "typeVersion": 1
    },
    {
      "id": "e6ce8653-5192-43de-b3ef-707871c88aac",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -592,
        640
      ],
      "parameters": {
        "width": 544,
        "height": 208,
        "content": "ğŸ“¬ OUTLOOK BUSINESS â†’ WHATSAPP\n==============================\nMonitors business account\n\nSetup:\nâ€¢ Outlook OAuth2 credential\nâ€¢ Update phone in \"Send to WhatsApp (Outlook Business)\" node\n"
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "template-ready-final",
  "connections": {
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "Parse Gmail Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Gmail Data": {
      "main": [
        [
          {
            "node": "Filter & Format Email (Gmail)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Filter & Format Email (Gmail)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Filter & Format Email (Outlook Personal)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Filter & Format Email (Outlook Business)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft Outlook Trigger": {
      "main": [
        [
          {
            "node": "Mark as Read (Outlook Personal)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft Outlook Trigger1": {
      "main": [
        [
          {
            "node": "Mark as Read (Outlook Business)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Outlook Business Data": {
      "main": [
        [
          {
            "node": "Filter & Format Email (Outlook Business)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Outlook Personal Data": {
      "main": [
        [
          {
            "node": "Filter & Format Email (Outlook Personal)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Format Email (Gmail)": {
      "main": [
        [
          {
            "node": "Mark as Read (Gmail)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send to WhatsApp (Gmail)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Read (Outlook Business)": {
      "main": [
        [
          {
            "node": "Parse Outlook Business Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Read (Outlook Personal)": {
      "main": [
        [
          {
            "node": "Parse Outlook Personal Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Format Email (Outlook Business)": {
      "main": [
        [
          {
            "node": "Send to WhatsApp (Outlook Business)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Format Email (Outlook Personal)": {
      "main": [
        [
          {
            "node": "Send to WhatsApp (Outlook Personal)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}