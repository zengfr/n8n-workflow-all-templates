{
  "id": "sBbL7CfgioXi9VJc",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Automate invoice analysis via Telegram with ChatGPT-4o-mini extraction",
    "wechat": "youandme10086",
    "id": 10288,
    "update_time": "2025-11-10"
  },
  "name": "Automate invoice analysis via Telegram with ChatGPT-4o-mini extraction",
  "tags": [],
  "nodes": [
    {
      "id": "b6433fae-ab23-4504-bf1c-07d98177799e",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "position": [
        -464,
        32
      ],
      "webhookId": "11b31e8e-4b0b-47a3-ba82-b4ffea5e34ae",
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "typeVersion": 1.2
    },
    {
      "id": "e631a3ed-6930-4da7-a5dc-f33b4c852426",
      "name": "Check if Document",
      "type": "n8n-nodes-base.if",
      "position": [
        -304,
        32
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "1",
              "operator": {
                "type": "object",
                "operation": "exists"
              },
              "leftValue": "={{ $json.message.document }}",
              "rightValue": ""
            }
          ]
        }
      },
      "typeVersion": 2
    },
    {
      "id": "a22e54b3-e4e0-4b67-8e8f-ef9a5f163fdb",
      "name": "Get File from Telegram",
      "type": "n8n-nodes-base.telegram",
      "position": [
        -128,
        -64
      ],
      "webhookId": "620221c5-ea8f-4c9e-bb04-b70114f27cb2",
      "parameters": {
        "fileId": "={{ $json.message.document.file_id }}",
        "resource": "file",
        "additionalFields": {}
      },
      "typeVersion": 1.2
    },
    {
      "id": "e93556dc-7af4-4e7d-9cb0-82aa0da39ed8",
      "name": "HTTP Request - Download File",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        32,
        -64
      ],
      "parameters": {
        "url": "=https://api.telegram.org/file/bot{{ $credentials.telegramApi.accessToken }}/{{ $json.result.file_path }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "aebfd1a1-bb29-4dbe-af72-4a6e986d4f79",
      "name": "Extract Invoice Data",
      "type": "n8n-nodes-base.extractFromFile",
      "position": [
        176,
        -64
      ],
      "parameters": {
        "operation": "extractFromPDF"
      },
      "typeVersion": 1
    },
    {
      "id": "c9bf8764-2bc9-4861-b477-bbb60d516f34",
      "name": "AI Agent - Analyze Invoice",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        320,
        -64
      ],
      "parameters": {
        "text": "=Analyze the following invoice text and extract key information:\n\n{{ $json.text }}\n\nProvide the following details:\n1. Invoice Number\n2. Invoice Date\n3. Vendor/Supplier Name\n4. Total Amount\n5. Currency\n6. Due Date\n7. Line Items (if available)\n8. Payment Status\n9. Any discrepancies or issues found\n\nFormat the response in a clear, structured manner.",
        "options": {
          "systemMessage": "You are an expert invoice analyst. Extract accurate information from invoices and identify any potential issues or discrepancies."
        },
        "promptType": "define",
        "hasOutputParser": true
      },
      "typeVersion": 1.7
    },
    {
      "id": "baead0ff-8676-4e77-9084-bd28484fc797",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        320,
        128
      ],
      "parameters": {
        "options": {
          "temperature": 0.2
        }
      },
      "credentials": {
        "openAiApi": {
          "id": "OGYj7DgYv5GFLFZk",
          "name": "OpenAi account 2"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "c149851f-3c38-4827-b1e9-14dbdbdd9172",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "position": [
        576,
        -64
      ],
      "parameters": {
        "jsCode": "const aiResponse = $input.first().json.output;\nconst originalMessage = $('Telegram Trigger').first().json;\n\nreturn {\n  json: {\n    chatId: originalMessage.message.chat.id,\n    analysis: aiResponse,\n    fileName: originalMessage.message.document?.file_name || 'Unknown',\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "typeVersion": 2
    },
    {
      "id": "b6c9a341-c390-4d8e-8ab7-ef7896bf87b4",
      "name": "Send Analysis to Telegram",
      "type": "n8n-nodes-base.telegram",
      "position": [
        720,
        -64
      ],
      "webhookId": "c8fc2be4-fef6-4434-86a8-4630d8c9c3b4",
      "parameters": {
        "text": "=üìÑ *Invoice Analysis Complete*\n\n*File:* {{ $json.fileName }}\n*Analyzed at:* {{ $json.timestamp }}\n\n*Results:*\n{{ $json.analysis }}\n\n‚úÖ Analysis completed successfully!",
        "chatId": "={{ $json.chatId }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "267e3223-6e60-432e-bb6d-980c2821b0e5",
      "name": "Send Error Message",
      "type": "n8n-nodes-base.telegram",
      "position": [
        -128,
        112
      ],
      "webhookId": "b419141c-c0cc-42ba-a2af-6ff60bfa6ba6",
      "parameters": {
        "text": "‚ùå Please send a document file (PDF or image) to check the invoice.",
        "chatId": "={{ $json.message.chat.id }}",
        "additionalFields": {}
      },
      "typeVersion": 1.2
    },
    {
      "id": "2f8e4a85-0db5-421a-93c1-b5a5cc8c701c",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1024,
        -256
      ],
      "parameters": {
        "width": 544,
        "height": 624,
        "content": "## Introduction\nUpload invoices via Telegram, receive structured data instantly. Perfect for accountants and finance teams.\n## How It Works\nTelegram bot receives invoices, downloads files, extracts data using OpenAI, then returns analysis.\n## Workflow Template\nTelegram Trigger ‚Üí Document Check ‚Üí Get File ‚Üí HTTP Download ‚Üí AI Extract ‚Üí Format Response ‚Üí Send to Telegram\n## Workflow Steps\n1. **Telegram Trigger:** Listens for uploads.\n2. **Document Check:** Validates files; routes errors.\n3. **Get File:** Retrieves metadata.\n4. **HTTP Download:** Fetches content.\n5. **AI Extract:** OpenAI parses invoice fields.\n6. **Format Response:** Structures data.\n7. **Send Analysis:** Delivers to chat.\n## Setup Instructions\n1. **Telegram Bot:** Create via BotFather, add credentials.\n2. **OpenAI Agent:** Add API key and extraction prompt.\n3. **HTTP Node:** Set authentication.\n4. **Parser:** Define invoice schema.\n5. **Error Handling:** Configure fallbacks.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "80d92c1c-d7b6-47ae-8f9d-8520e61708a8",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        512,
        112
      ],
      "parameters": {
        "color": 4,
        "width": 320,
        "height": 288,
        "content": "## Prerequisites\n- n8n instance\n- Telegram Bot Token\n- OpenAI API key\n## Customization\n- Database storage\n- Accounting software integration\n## Benefits\n- Eliminates manual entry\n- Reduces errors"
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8c2bf80d-d1f6-4b32-bd5a-cf0b88f24786",
  "connections": {
    "Format Response": {
      "main": [
        [
          {
            "node": "Send Analysis to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Check if Document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Document": {
      "main": [
        [
          {
            "node": "Get File from Telegram",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Error Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - Analyze Invoice",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Extract Invoice Data": {
      "main": [
        [
          {
            "node": "AI Agent - Analyze Invoice",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get File from Telegram": {
      "main": [
        [
          {
            "node": "HTTP Request - Download File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Analyze Invoice": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request - Download File": {
      "main": [
        [
          {
            "node": "Extract Invoice Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}