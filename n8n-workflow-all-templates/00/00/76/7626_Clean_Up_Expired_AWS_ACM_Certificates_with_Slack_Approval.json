{
  "id": "LXlpaRRd2PCDwtpS",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Clean Up Expired AWS ACM Certificates with Slack Approval",
    "wechat": "youandme10086",
    "id": 7626,
    "update_time": "2025-11-10"
  },
  "name": "Clean Up Expired AWS ACM Certificates with Human Approval",
  "tags": [
    {
      "id": "dYBhBbLil49yLKT5",
      "name": "acm",
      "createdAt": "2025-09-14T12:28:42.882Z",
      "updatedAt": "2025-09-14T12:28:42.882Z"
    },
    {
      "id": "zVkByIt5M465W2a8",
      "name": "aws",
      "createdAt": "2025-09-12T06:14:33.823Z",
      "updatedAt": "2025-09-12T06:14:33.823Z"
    }
  ],
  "nodes": [
    {
      "id": "b8255d4e-1833-4d2a-bd26-6765dc0fd9b8",
      "name": "Get many certificates",
      "type": "n8n-nodes-base.awsCertificateManager",
      "position": [
        1488,
        672
      ],
      "parameters": {
        "options": {},
        "operation": "getMany"
      },
      "credentials": {
        "aws": {
          "id": "mx7x25MWVlUbEtd3",
          "name": "ap-southeast-1"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "8a87ac3e-0d8d-4055-8a04-55890de42098",
      "name": "Send message and wait for response",
      "type": "n8n-nodes-base.slack",
      "position": [
        1936,
        672
      ],
      "webhookId": "a2040fd8-4de2-4eb9-ad51-fa9a5b974afc",
      "parameters": {
        "select": "channel",
        "message": "=:warning: *Expired SSL Certificate Detected*\nAn SSL certificate in AWS ACM has expired. Please review the details below and approve deletion to keep the environment clean.\n*üìÑ Certificate Summary:*\n‚Ä¢ *Domain Name:* `{{ $json.DomainName }}`\n‚Ä¢ *Certificate ARN:* `{{ $json.CertificateArn }}`\n‚Ä¢ *Issueed Date:* `{{ $json.IssuedAt.toDateTime('s').toString() }}`\n‚Ä¢ *Expiration Date:* `{{ $json.NotAfter.toDateTime('s').toString() }}`\n\nüëâ *Next Step:*  \nReact to this message with:\n:white_check_mark: to approve deletion  \n:x: to keep the certificate\n\n_(This message will be auto-checked in 1 hour for reactions.)_",
        "options": {
          "limitWaitTime": {
            "values": {
              "resumeUnit": "minutes",
              "resumeAmount": 60
            }
          }
        },
        "channelId": {
          "__rl": true,
          "mode": "list",
          "value": "C09E9SDE99P",
          "cachedResultName": "all-automatewithme"
        },
        "operation": "sendAndWait",
        "authentication": "oAuth2",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        }
      },
      "credentials": {
        "slackOAuth2Api": {
          "id": "50sk9yul5PctbgzM",
          "name": "Slack account"
        }
      },
      "typeVersion": 2.3
    },
    {
      "id": "850d6648-6d31-40c3-ae9a-946af0c1fb4f",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "parameters": {
        "width": 1056,
        "height": 1744,
        "content": "# Clean Up Expired AWS ACM Certificates with Human Approval\n> Automate the cleanup of expired AWS ACM certificates with Slack-based approval. This workflow helps maintain a secure and tidy AWS environment by detecting expired SSL certs, sending detailed Slack notifications to admins, and deleting them upon approval, ensuring full visibility and control over certificate lifecycle management.\n## üßë‚Äçüíº Who‚Äôs it for\n\nThis workflow is designed for:\n- **AWS administrators** who want to keep their environment clean and secure  \n- **DevOps teams** managing SSL lifecycle in AWS ACM  \n- **IT Admins** needing visibility and control over expired cert removal  \n- Teams that use **Slack for collaboration and approvals**\n\n## ‚öôÔ∏è How it works / What it does\n\nThis automated workflow performs the following tasks on a **daily schedule**:\n1. **Fetch all ACM certificates** in your AWS account.\n2. **Filter out the expired ones** by comparing expiration date and status.\n3. **Send a Slack approval message** with certificate details to the admin team.\n4. **Wait for approval response** directly in Slack (`‚úÖ` to approve deletion).\n5. If approved, it **deletes the expired certificate** using AWS ACM.\n6. Finally, it **notifies the IT admin** about the action taken.\n\n## üîß How to set up\n\n1. **Create the Workflow**\n   - Add the nodes as shown:\n     - `Schedule Trigger`\n     - `AWS - ACM: listCertificates`\n     - `AWS - ACM: describeCertificate` (loop per cert)\n     - `IF Node` to filter expired certs\n     - `Slack - Send & Wait for Reaction`\n     - `AWS - ACM: deleteCertificate`\n     - `Slack - Post Message` to notify\n\n2. **Configure Slack**\n   - Create a **Slack Bot Token** with:\n     - `chat:write`\n     - `reactions:read`\n     - `channels:read`\n   - Connect it in your Slack nodes.\n\n3. **Configure AWS Credentials**\n   - Use IAM User or Role with:\n     - `acm:ListCertificates`\n     - `acm:DescribeCertificate`\n     - `acm:DeleteCertificate`\n\n4. **Set schedule**\n   - Daily, Weekly, or custom cron expression.\n\n## üìã Requirements\n\n| Component         | Description                          |\n|------------------|--------------------------------------|\n| AWS ACM Access   | IAM permissions for ACM actions      |\n| Slack Bot Token  | With `chat:write` & `reactions:read` |\n| n8n Environment  | Self-hosted or n8n Cloud             |\n| Slack Channel    | Where approval messages will be sent |\n\n## üõ†Ô∏è How to customize the workflow\n\n### üïí Change waiting time\nAdjust the wait time before checking Slack reactions in the `sendAndWait` node (default 1 hour).\n\n### üë• Change Slack target\nChange the Slack channel or tag specific people (`<@U123456>`).\n\n### üìì Add logging\nAdd Google Sheets, Notion, or DynamoDB to log certificate details and approval decisions.\n\n### üß™ Add dry-run/test mode\nUse an IF node before deletion to simulate removal when `ENV === dry-run`.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "157f4f83-982e-45b1-89d3-ed97add2dc18",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1152,
        496
      ],
      "parameters": {
        "width": 272,
        "height": 128,
        "content": "### 1. Schedule Trigger\nThe workflow starts on a scheduled basis (e.g., daily at 09:00) to automatically check ACM certificates without manual intervention."
      },
      "typeVersion": 1
    },
    {
      "id": "ef789415-a065-494c-a76e-3752f3bcd067",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1424,
        864
      ],
      "parameters": {
        "width": 208,
        "content": "### 2. Get Certificates\nFetches all ACM certificates in the configured AWS region(s), including details such as domain names, status, and expiration dates."
      },
      "typeVersion": 1
    },
    {
      "id": "e6ed25f7-6a0a-4a08-a9e2-6116602befe0",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1664,
        480
      ],
      "parameters": {
        "width": 192,
        "content": "### 3. Filter Expired Certificates Only\nChecks each certificate and keeps only those that expired already.\n\n"
      },
      "typeVersion": 1
    },
    {
      "id": "82b3bc46-51e2-4095-9088-c7c004cd25dd",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1872,
        864
      ],
      "parameters": {
        "height": 176,
        "content": "### 4. Notify via Slack and Wait for Approval\nSends a Slack message with certificate details (domain, ARN, expiration date, status).  \nThe workflow pauses here until a user clicks **Approve** or **Reject**."
      },
      "typeVersion": 1
    },
    {
      "id": "2f8fec8a-5c9f-4798-bea1-1bda1d9fe34c",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2048,
        480
      ],
      "parameters": {
        "width": 304,
        "content": "### 5. Delete Expired Certificate\nIf **Approve** is selected in Slack, the workflow triggers AWS ACM to delete the certificate automatically.  \nIf **Reject** is clicked, no action is taken, and the workflow ends."
      },
      "typeVersion": 1
    },
    {
      "id": "06041393-d540-4fac-8fde-2cdcf82d7076",
      "name": "Inform IT Admin",
      "type": "n8n-nodes-base.slack",
      "position": [
        2384,
        672
      ],
      "webhookId": "7ea60ebd-bef7-4a22-ba58-4009b32b63b4",
      "parameters": {
        "text": "=:white_check_mark: *ACM Certificate Deleted Successfully*\n\n*Domain:* {{ $('Get expired certification only').item.json.DomainName }}\n*ARN:* {{ $('Get expired certification only').item.json.CertificateArn }}\n*Deleted At:* {{ $now }}\n\nApproved by: {{ $('Send message and wait for response').item.json.user?.name || $('Send message and wait for response').item.json.username || 'N/A' }}",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "list",
          "value": "C09E9SDE99P",
          "cachedResultName": "all-automatewithme"
        },
        "otherOptions": {},
        "authentication": "oAuth2"
      },
      "credentials": {
        "slackOAuth2Api": {
          "id": "50sk9yul5PctbgzM",
          "name": "Slack account"
        }
      },
      "typeVersion": 2.3
    },
    {
      "id": "82838a2a-acbb-440f-b92e-a690d4d77eaf",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1664,
        0
      ],
      "parameters": {
        "width": 608,
        "height": 416,
        "content": "![](https://wisestackai.s3.ap-southeast-1.amazonaws.com/Screenshot+2025-08-20+at+11.31.13%E2%80%AFAM.png)"
      },
      "typeVersion": 1
    },
    {
      "id": "840e55be-4677-482a-a0cd-e873ac1543e2",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2352,
        864
      ],
      "parameters": {
        "height": 80,
        "content": "### 6. Notify admin via Slack"
      },
      "typeVersion": 1
    },
    {
      "id": "a60120e3-cd57-4890-b60b-7e7e0dfca469",
      "name": "Get expired certification only",
      "type": "n8n-nodes-base.filter",
      "position": [
        1712,
        672
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "fe1b749d-3046-465e-b60a-786f5b0e2f99",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $json.Status }}",
              "rightValue": "=EXPIRED"
            }
          ]
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "1b161032-42b7-46fb-b35d-57c9c1b4c909",
      "name": "Daily Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        1264,
        672
      ],
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "4422b86f-5764-4f03-bff7-7b36271297aa",
      "name": "Delete ACM Certificate",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2160,
        672
      ],
      "parameters": {
        "url": "https://acm.ap-southeast-1.amazonaws.com",
        "body": "={\n  \"CertificateArn\": \"{{ $('Get many certificates').item.json.CertificateArn }}\"\n}",
        "method": "POST",
        "options": {},
        "sendBody": true,
        "contentType": "raw",
        "sendHeaders": true,
        "authentication": "predefinedCredentialType",
        "rawContentType": "application/x-amz-json-1.1",
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Amz-Target",
              "value": "CertificateManager.DeleteCertificate"
            }
          ]
        },
        "nodeCredentialType": "aws"
      },
      "credentials": {
        "aws": {
          "id": "mx7x25MWVlUbEtd3",
          "name": "ap-southeast-1"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "be740cbf-5740-4e29-bfca-96cb5fb93094",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2608,
        640
      ],
      "parameters": {
        "width": 736,
        "height": 208,
        "content": "![](https://s3.ap-southeast-1.amazonaws.com/automatewith.me/screenshots/Screenshot+2025-09-14+at+7.49.43%E2%80%AFPM.png)"
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "398806b1-2cbf-4675-9888-1ab1b2b47d74",
  "connections": {
    "Get many certificates": {
      "main": [
        [
          {
            "node": "Get expired certification only",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Daily Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get many certificates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete ACM Certificate": {
      "main": [
        [
          {
            "node": "Inform IT Admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get expired certification only": {
      "main": [
        [
          {
            "node": "Send message and wait for response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send message and wait for response": {
      "main": [
        [
          {
            "node": "Delete ACM Certificate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}