{
  "id": "gVsYIc202VgqnM5S",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Send Automatic WhatsApp Order Confirmations from Shopify with Rapiwa API",
    "wechat": "youandme10086",
    "id": 9262,
    "update_time": "2025-11-10"
  },
  "name": "Send Automatic WhatsApp Order Confirmations from Shopify with Rapiwa API",
  "tags": [],
  "nodes": [
    {
      "id": "49f6c0b4-d943-425b-8e90-5bb3264300f0",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "position": [
        1568,
        304
      ],
      "parameters": {
        "options": {}
      },
      "typeVersion": 3
    },
    {
      "id": "4a602b94-9664-429c-86f1-5faf96cc8a59",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        1168,
        304
      ],
      "webhookId": "a9b6a936-e5f2-4d4c-9cf9-182de0a970d5",
      "parameters": {
        "path": "a9b6a936-e5f2-4d4c-9cf9-182de0a970d5",
        "options": {},
        "httpMethod": "POST"
      },
      "typeVersion": 2
    },
    {
      "id": "34695eb4-af92-47fa-b499-d0232d2fd47b",
      "name": "Clean WhatsApp Number",
      "type": "n8n-nodes-base.code",
      "position": [
        2336,
        320
      ],
      "parameters": {
        "jsCode": "const items = $input.all();\nconst updatedItems = items.map((item) => {\n  const waNo = item?.json[\"WhatsApp No\"];\n  const waNoStr = typeof waNo === 'string' ? waNo : (waNo !== undefined && waNo !== null ? String(waNo) : \"\");\n  const cleanedNumber = waNoStr.replace(/\\D/g, \"\");\n  item.json[\"WhatsApp No\"] = cleanedNumber;\n  return item;\n});\nreturn updatedItems;"
      },
      "typeVersion": 2
    },
    {
      "id": "950fd5e6-df76-4ede-8cef-f0bf83e96d03",
      "name": "Check valid whatsapp number Using Rapiwa1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2608,
        320
      ],
      "parameters": {
        "url": "=https://app.rapiwa.com/api/verify-whatsapp",
        "method": "POST",
        "options": {},
        "sendBody": true,
        "authentication": "genericCredentialType",
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $json[\"WhatsApp No\"] }}"
            }
          ]
        },
        "genericAuthType": "httpBearerAuth"
      },
      "credentials": {
        "httpBearerAuth": {
          "id": "jnaHCyYia9OAFozh",
          "name": "Rapiwa Bearer YOUR_TOKEN_HERE"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "384a2bfb-85ed-4d73-8918-db5443707362",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2240,
        -320
      ],
      "parameters": {
        "width": 576,
        "height": 992,
        "content": "## Clean and Verify WhatsApp Numbers\nBefore sending messages, each WhatsApp number is cleaned (removing spaces and symbols) and checked to make sure itâ€™s a real, active WhatsApp account. Only valid numbers will get a message, so you donâ€™t waste time or credits.\n\n- **Node:** Clean WhatsApp Number\n\n**Purpose:** Removes extra characters (like spaces, dashes, or parentheses) from the phone number.\n\n**Why it's important:** WhatsApp only accepts clean numeric formats. This step avoids delivery errors.\n\n- **Node:** Check valid whatsapp number Using Rapiwa\n  - Checks if the WhatsApp number is real and can receive messages.\n  - Only valid numbers will get a message."
      },
      "typeVersion": 1
    },
    {
      "id": "24bd6b89-6c12-429b-89c2-af26f7a5ec36",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2832,
        -320
      ],
      "parameters": {
        "color": 5,
        "width": 432,
        "height": 992,
        "content": "## Conditional Logic\n\nThe **If** node checks whether `data.exists == true`:\n\n- **True branch (verified):**\n  - Sends a WhatsApp confirmation via Rapiwa.\n  - Appends to Google Sheets with validity: verified.\n\n- **False branch (unverified):**\n  - Appends data to the sheet with validity: unverified.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "6e674ebc-6552-4b42-acdb-1953f7c070d7",
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3280,
        -320
      ],
      "parameters": {
        "color": 4,
        "width": 880,
        "height": 688,
        "content": "## Send Message via HTTP Request Using Rapiwa\n\n**Purpose:** Sends the actual message via the Rapiwa API.\n\n**How it works:** Makes a POST request to `https://app.rapiwa.com/api/send-message` with:\n- `number`: Cleaned WhatsApp number  \n- `message`: The text from the sheet\n\n**Why it's important:** This is the core of the automation â€” it connects your message to WhatsApp via Rapiwa.\n\n\n\n## Change State of Rows in Sent\n**Why it's important:** So you donâ€™t accidentally resend the same message in the next cycle. Keeps track of whatâ€™s already done.\n\nTwo separate Google Sheets nodes:\n- **Verified append row in sheet** â€“ for valid numbers.\n- **Unverified append row in sheet** â€“ for invalid numbers.\n- **A Google Sheet** formatted like this âž¤ [sample](https://docs.google.com/spreadsheets/d/1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo/edit?usp=sharing)\n"
      },
      "typeVersion": 1
    },
    {
      "id": "426ebbd2-7716-4760-b482-780ac36a958d",
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3280,
        384
      ],
      "parameters": {
        "color": 7,
        "width": 886,
        "height": 624,
        "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Append Unverified Row to Sheet\nThis node is triggered after a phone number is checked and found to be **unverified**. It appends the form submission data to the Google Sheet with the field `validity` set to `\"unverified\"`.\n\nThis node appends data to a Google Sheet when a WhatsApp number is **unverified**.\n- **A Google Sheet** formatted like this âž¤ [sample](https://docs.google.com/spreadsheets/d/1H29z_8tnsu8AvCsI7o1SjiV-5LDTwiVVQk-BNr8SMk0/edit?usp=sharing)  \n\n\n## Wait\n\n**Purpose:** Pauses for a few seconds (e.g., 5 sec) before sending the next message.\n\n**Why it's important:** Prevents sending too many messages too quickly, which could get your WhatsApp number flagged or blocked.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "645ed438-a1ca-4158-bb3d-2f304aa337d5",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "position": [
        3680,
        448
      ],
      "webhookId": "6c474e54-eb3c-4fcd-b455-948322cd0121",
      "parameters": {},
      "typeVersion": 1.1
    },
    {
      "id": "7c761688-bd05-465e-80f2-651b03f8f438",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [
        2976,
        320
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "3ab8725a-9268-45fd-b91c-0e055fe6fa7c",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              },
              "leftValue": "={{ $json.data.exists }}",
              "rightValue": "=\"true\""
            }
          ]
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "153f0f6d-d2fa-4459-a092-99722b68697d",
      "name": "Change State of Rows in Unverified & Not Sent",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        3440,
        448
      ],
      "parameters": {
        "columns": {
          "value": {
            "row_number": "={{ $('Limit').item.json.row_number }}"
          },
          "schema": [
            {
              "id": "email",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "email",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "name",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "name",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "number",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "number",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "order id",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "order id",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "item name",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "item name",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "total price",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "total price",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "validity",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "validity",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "status",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "type": "number",
              "display": true,
              "removed": false,
              "readOnly": true,
              "required": false,
              "displayName": "row_number",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [
            "row_number"
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {},
        "operation": "update",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "gid=0",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo/edit#gid=0",
          "cachedResultName": "Sheet1"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo/edit?usp=drivesdk",
          "cachedResultName": "Shopify - Send WhatsApp confirmation with order ID"
        }
      },
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "gFH3Wjq6yYqSEAei",
          "name": "Google Sheets"
        }
      },
      "typeVersion": 4.6
    },
    {
      "id": "416c0533-1aad-4885-a607-17b5770d67e2",
      "name": "Send Message Using Rapiwa",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        3440,
        144
      ],
      "parameters": {
        "url": "https://app.rapiwa.com/api/send-message",
        "method": "POST",
        "options": {},
        "sendBody": true,
        "authentication": "genericCredentialType",
        "bodyParameters": {
          "parameters": [
            {
              "name": "=number",
              "value": "={{ $json.customer_phone }}"
            },
            {
              "name": "message_type",
              "value": "text"
            },
            {
              "name": "message",
              "value": "=Hi *{{ $json.customer_full_name }}*,\n\nThank you for shopping with *SpaGreen Creative*!\nWe're happy to confirm that your order has been successfully placed. \n\nðŸ§¾ *Order Details*\nâ€¢ *Product*: {{ $json.line_item.title }}\nâ€¢ *SKU*: {{ $json.line_item.sku }}\nâ€¢ *Quantity*: {{ $json.line_item.quantity }}\nâ€¢ *Vendor*: {{ $json.line_item.vendor }}\nâ€¢ *Order ID*: {{ $json.name }}\nâ€¢ *Product ID*: {{ $json.line_item.product_id }}\n\nðŸ“¦ *Shipping Information*\n{{ $json.shipping_address.address1 }} {{ $json.shipping_address.address2 }}\n{{ $json.shipping_address.city }}, {{ $json.shipping_address.country }} - {{ $json.shipping_address.zip }}\n\nðŸ’³ *Payment Summary*\nâ€¢ *Subtotal*: {{ $json.subtotal_price }} BDT\nâ€¢ *Tax (VAT)*: {{ $json.total_tax_amount }} BDT\nâ€¢ *Shipping*: {{ $json.total_shipping_amount }} BDT\nâ€¢ *Discount*: {{ $json.total_discount_amount }} BDT\nâ€¢ *Total Paid*: {{ $json.total_price }} BDT\n\nðŸ“… **Order Date**: {{ $json.created_date }}\n\nThank you once again for choosing us. If you need any help or have questions, feel free to reach out anytime â€” we're here for you!\n\nWarm wishes,\n*Team SpaGreen Creative*"
            },
            {
              "name": "status"
            }
          ]
        },
        "genericAuthType": "httpHeaderAuth"
      },
      "credentials": {
        "httpBearerAuth": {
          "id": "zb79NbTCD3LbxmSs",
          "name": "Bearer YOUR_TOKEN_HERE account"
        },
        "httpHeaderAuth": {
          "id": "i9zvAj1mpabm9ci9",
          "name": "shopify-app-auth"
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "d4a7a2df-6518-4ade-ad00-e833c254d847",
      "name": "Change State of Rows in Verified & Sent",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        3680,
        144
      ],
      "parameters": {
        "columns": {
          "value": {
            "name": "={{ $json.name }}",
            "email": "={{ $json.email }}",
            "number": "={{ $json.phone }}",
            "status": "={{ $json.success }}",
            "order id": "={{ $json.customer_id }}",
            "validity": "verified",
            "item name": "={{ $json.product_title }}",
            "row_number": 0,
            "total price": "={{ $json.total_price }}"
          },
          "schema": [
            {
              "id": "email",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "email",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "name",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "name",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "number",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "number",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "order id",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "order id",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "item name",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "item name",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "total price",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "total price",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "validity",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "validity",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "status",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "type": "number",
              "display": true,
              "removed": false,
              "readOnly": true,
              "required": false,
              "displayName": "row_number",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [
            "status"
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {},
        "operation": "update",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "gid=0",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo/edit#gid=0",
          "cachedResultName": "Sheet1"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo/edit?usp=drivesdk",
          "cachedResultName": "Shopify - Send WhatsApp confirmation with order ID"
        }
      },
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "gFH3Wjq6yYqSEAei",
          "name": "Google Sheets"
        }
      },
      "typeVersion": 4.6
    },
    {
      "id": "3d0e7cb5-1c19-4366-a252-432f3406b875",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1072,
        -320
      ],
      "parameters": {
        "color": 7,
        "width": 320,
        "height": 992,
        "content": "## Webhook\n\n### Purpose:\n- Listens for incoming **HTTP POST requests**.\n- This webhook is likely triggered by an event (e.g., order creation or update) from an external platform like **Shopify** or **WooCommerce**.\n- The incoming data is passed to the next node for processing."
      },
      "typeVersion": 1
    },
    {
      "id": "b7e88ae6-6136-41f7-aa18-5eba05dbe026",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1408,
        -320
      ],
      "parameters": {
        "color": 2,
        "width": 816,
        "height": 992,
        "content": "## Loop Over Items\n**Purpose:** Goes through each row (message) one by one.\n**Why it's important:** Ensures that each message is processed separately and in order.\n\n\n##  & Code\n### Function:\n- Extracts and transforms incoming JSON data into a cleaner, structured format.\n- Specifically:\n  - Extracts customer information (`email`, `phone`, `name`, `ID`, full name, country, etc.).\n  - Extracts address data (both default and shipping addresses).\n  - Extracts financial data (subtotal, total, taxes, discounts, shipping).\n  - Extracts line item (product) details like title, SKU, vendor, product ID, etc.\n- Returns a clean, ready-to-use object for further processing (e.g., verification, messaging, storage).\n\n### Like Key Fields Extracted:\n- `customer_email`, `customer_phone`, `customer_full_name`, `customer_id`\n- `customer_address` and `shipping_address`\n- `total_price`, `subtotal_price`, `total_tax_amount`, etc.\n- `line_item`: `title`, `sku`, `quantity`, `vendor`, `product_id`\n- `created_date`, `updated_at`"
      },
      "typeVersion": 1
    },
    {
      "id": "821172b6-321e-4c9d-93c8-078ef48821c4",
      "name": "Clean Webhooks Response Data",
      "type": "n8n-nodes-base.code",
      "position": [
        1936,
        320
      ],
      "parameters": {
        "jsCode": "const result = $input.all().map(item => {\n  const body = item.json.body || {};\n  const customer = body.customer || {};\n  const defaultAddress = customer.default_address || {};\n  const shippingAddress = body.shipping_address || {};\n  const lineItem = (body.line_items && body.line_items[0]) || {};\n  const totalTaxSet = body.total_tax_set?.shop_money || {};\n  const totalDiscountSet = body.total_discounts_set?.shop_money || {};\n  const totalShippingSet = body.total_shipping_price_set?.shop_money || {};\n\n  return {\n    customer_email: customer.email,\n    customer_phone: customer.phone,\n    created_date: body.created_at,\n    updated_at: body.updated_at,\n    name: body.name,\n    customer_full_name: `${customer.first_name || ''} ${customer.last_name || ''}`.trim(),\n    customer_id: customer.id,\n    country_code: defaultAddress.country_code,\n    customer_address: {\n      country: defaultAddress.country,\n      city: defaultAddress.city,\n      zip: defaultAddress.zip,\n      address1: defaultAddress.address1,\n      address2: defaultAddress.address2\n    },\n    subtotal_price: body.subtotal_price,\n    total_price: body.total_price,\n    total_tax_amount: totalTaxSet.amount,\n    total_discount_amount: totalDiscountSet.amount,\n    total_shipping_amount: totalShippingSet.amount,\n    shipping_address: {\n      country: shippingAddress.country,\n      city: shippingAddress.city,\n      zip: shippingAddress.zip,\n      address1: shippingAddress.address1,\n      address2: shippingAddress.address2\n    },\n    line_item: {\n      title: lineItem.title,\n      sku: lineItem.sku,\n      quantity: lineItem.quantity,\n      vendor: lineItem.vendor,\n      product_id: lineItem.product_id\n    }\n  };\n});\n\nreturn result;"
      },
      "typeVersion": 2
    },
    {
      "id": "e25c79ad-1ed7-47d9-a0c2-4eccd744c77b",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -304,
        -320
      ],
      "parameters": {
        "color": 4,
        "width": 1280,
        "height": 2720,
        "content": " # Send Automatic WhatsApp Order Confirmations from Shopify with Rapiwa API\n\n ## Overview\n This n8n workflow receives new order data, normalizes the payload, validates the customer's WhatsApp number using the Rapiwa API, sends a personalized order confirmation message to verified numbers, and logs every attempt to Google Sheets.\n\n## Why use this workflow\n - Automated order confirmations via WhatsApp (no manual messaging)\n - Personalized messages with order, payment and shipping details\n - Keeps a clean audit trail in Google Sheets (sent / not sent, verified / unverified)\n - Batching + wait/delays helps avoid rate limits and number flags\n\n## Quick features\n - Accepts webhook or Google Sheet rows as input\n - Cleans and normalizes phone numbers\n - Verifies WhatsApp registration with Rapiwa\n - Sends templated WhatsApp messages via Rapiwa\n - Updates Google Sheet rows with `status` and `validity`\n\n## Requirements\n - Shopify order webhook or sheet with new order rows\n - Rapiwa account + API access (Bearer YOUR_TOKEN_HERE)\n - Google Sheets OAuth2 credential configured in n8n\n - A Google Sheet with columns: `name`, `number`, `order id`, `item name`, `total price`, `validity`, `status` (see sample below)\n\n## High-level flow (step-by-step)\n 1. Webhook / Trigger\n    - Node: `Webhook` (or Google Sheets trigger)\n    - What: Receives new order data (Shopify webhook or sheet row).\n\n 2. Split into single items\n    - Node: `Loop Over Items` (SplitInBatches)\n    - What: Process one order at a time to allow per-order logic and batching.\n\n 3. Normalize payload\n    - Node: `Clean Webhooks Response Data` (Code)\n    - What: Extract customer, order, shipping and line-item fields into a consistent JSON structure like `customer_full_name`, `customer_phone`, `line_item.title`, `total_price`.\n\n 4. Clean WhatsApp number\n    - Node: `Clean WhatsApp Number` (Code)\n    - What: Remove all non-digit characters: `waNoStr.replace(/\\D/g, \"\")`.\n    - Note: This step does not add a country code â€” ensure numbers include the country code or add logic to prepend it.\n\n 5. Verify WhatsApp registration\n    - Node: `Check valid whatsapp number Using Rapiwa1` (HTTP Request)\n    - Endpoint: `https://app.rapiwa.com/api/verify-whatsapp` (POST)\n    - Auth: `Rapiwa Bearer YOUR_TOKEN_HERE` (httpBearerAuth)\n    - What: Returns `data.exists` indicating whether the number is WhatsApp-registered.\n\n 6. Branch on validity\n    - Node: `If`\n    - Condition: `={{ $json.data.exists }}` equals `\"true\"` (in the export). Verify this in your environment â€” adjust to a boolean check if needed.\n\n    If verified:\n    - Node: `Send Message Using Rapiwa` (HTTP Request)\n      - Endpoint: `https://app.rapiwa.com/api/send-message` (POST)\n      - Body: `number`, `message_type: text`, `message` (templated)\n      - Auth: `shopify-app-auth` (httpHeaderAuth in the export) â€” make sure it matches your Rapiwa credential type.\n    - Node: `Change State of Rows in Verified & Sent` (Google Sheets)\n      - Action: Update row with `validity: verified`, `status: sent`, and other mapped columns.\n\n    If not verified:\n    - Node: `Change State of Rows in Unverified & Not Sent` (Google Sheets)\n      - Action: Update row with `validity: unverified`, `status: not sent`.\n\n 7. Wait and continue\n    - Node: `Wait`\n    - What: Pause between iterations (e.g., 3â€“10 seconds) to avoid rate limits and reduce risk of being flagged.\n\n## Message template (example)\n Use the templated message in `Send Message Using Rapiwa` (multiline text):\n\n ```\n Hi *{{ $json.customer_full_name }}*,\n Thank you for shopping with *SpaGreen Creative*! We're happy to confirm that your order has been successfully placed.\n ðŸ§¾ Order Details\n â€¢ Product: {{ $json.line_item.title }}\n â€¢ SKU: {{ $json.line_item.sku }}\n â€¢ Quantity: {{ $json.line_item.quantity }}\n â€¢ Vendor: {{ $json.line_item.vendor }}\n â€¢ Order ID: {{ $json.name }}\n â€¢ Product ID: {{ $json.line_item.product_id }}\n ðŸ“¦ Shipping Information\n {{ $json.shipping_address.address1 }} {{ $json.shipping_address.address2 }}\n {{ $json.shipping_address.city }}, {{ $json.shipping_address.country }} - {{ $json.shipping_address.zip }}\n ðŸ’³ Payment Summary\n â€¢ Subtotal: {{ $json.subtotal_price }} BDT\n â€¢ Tax (VAT): {{ $json.total_tax_amount }} BDT\n â€¢ Shipping: {{ $json.total_shipping_amount }} BDT\n â€¢ Discount: {{ $json.total_discount_amount }} BDT\n â€¢ Total Paid: {{ $json.total_price }} BDT\n Order Date: {{ $json.created_date }}\n Warm wishes,\n *Team SpaGreen Creative*\n ```\n\n## Google Sheet sample\n A suggested sheet layout (header row):\n- **A Google Sheet** formatted like this âž¤ [Sample](https://docs.google.com/spreadsheets/d/1b5b9kvkfuCMtZ-7Z-w21sXOmHFmQ30N1iQPc2WMStEo/edit?usp=sharing)  \n\n\n| name        | number        | order id      | item name                      | total price | validity | status |\n| ----------- | ------------- | ------------- | ------------------------------ | ----------- | -------- | ------ |\n| Abdul Mannan | 8801322827799 | 8986469695806 | Iphone 10                      | 1150        | verified | sent   |\n| Abdul Mannan | 8801322827799 | 8986469695806 | S25 UltraXXXXeen Android Phone | 23000       | verified | sent   |\n\n\n## Configuration & notes\n - Credentials in the export:\n   - `Rapiwa Bearer YOUR_TOKEN_HERE` (httpBearerAuth) â€” used by the verification node.\n   - `shopify-app-auth` (httpHeaderAuth) â€” used by the send-message node in the export; make sure you use the correct credential type for Rapiwa in your instance.\n - The `If` node compares to `\"true\"` string â€” adjust to a boolean test if Rapiwa returns boolean `true/false`.\n - `Clean WhatsApp Number` strips non-digits but does not add country codes.\n - The Google Sheets nodes use `row_number` to match rows for updates â€” avoid reordering rows or prefer a unique `order id` for resilience.\n\n## Quick troubleshooting\n - No messages sent: inspect the `Check valid whatsapp number` node output to verify `data.exists`.\n - Wrong phone formats: add country-code normalization in the `Clean WhatsApp Number` node.\n - Google Sheets update fails: check the sheet ID, sheet gid, and credential permissions."
      },
      "typeVersion": 1
    },
    {
      "id": "832d90a7-fdde-4bb0-a7ea-7f10259825dd",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1072,
        -496
      ],
      "parameters": {
        "color": 3,
        "width": 3088,
        "content": "## Workflow Summary:\n\n1. **Webhook** receives a POST request with raw order/customer data.\n2. Data is passed to **Loop Over Items**, which processes each item one at a time or in batches.\n3. **Code** node reformats and cleans the data into a structured JSON format for use in later parts of the workflow (e.g., validation, messaging, or storage).\n\n"
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2ffa1a74-0a5c-494a-95c0-c828fb29bf10",
  "connections": {
    "If": {
      "main": [
        [
          {
            "node": "Send Message Using Rapiwa",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Change State of Rows in Unverified & Not Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Clean Webhooks Response Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean WhatsApp Number": {
      "main": [
        [
          {
            "node": "Check valid whatsapp number Using Rapiwa1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Message Using Rapiwa": {
      "main": [
        [
          {
            "node": "Change State of Rows in Verified & Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean Webhooks Response Data": {
      "main": [
        [
          {
            "node": "Clean WhatsApp Number",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Change State of Rows in Verified & Sent": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check valid whatsapp number Using Rapiwa1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Change State of Rows in Unverified & Not Sent": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}