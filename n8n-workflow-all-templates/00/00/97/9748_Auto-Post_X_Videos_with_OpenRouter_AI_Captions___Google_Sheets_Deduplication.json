{
  "id": "6SOSDrfhrqAX7DBS",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Auto-Post X Videos with OpenRouter AI Captions & Google Sheets Deduplication",
    "wechat": "youandme10086",
    "id": 9748,
    "update_time": "2025-11-10"
  },
  "name": "Deduplicate and auto-post X videos with AI captions from a user",
  "tags": [],
  "nodes": [
    {
      "id": "b4721eab-d2f9-4687-be1b-15ef709f4eb9",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "notes": "è¨­å®šã—ãŸæ™‚é–“é–“éš”ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•çš„ã«é–‹å§‹ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã§ã™ã€‚",
      "position": [
        -160,
        256
      ],
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours"
            }
          ]
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "ced6b0eb-8a23-4a07-aba2-140f9b1c0480",
      "name": "Get User ID",
      "type": "n8n-nodes-base.httpRequest",
      "notes": "æŒ‡å®šãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹ã‚‰ API ã§åˆ©ç”¨ã™ã‚‹ user.id ã‚’å–å¾—ã—ã¾ã™ã€‚",
      "position": [
        64,
        256
      ],
      "parameters": {
        "url": "https://api.twitter.com/2/users/by/username/XXXXXXXXX",
        "options": {},
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "n8n-workflow"
            }
          ]
        }
      },
      "typeVersion": 4.2
    },
    {
      "id": "fd64a087-90ed-43c9-8305-358dd1b58b40",
      "name": "Get Tweets with Videos",
      "type": "n8n-nodes-base.httpRequest",
      "notes": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ€æ–°ãƒ„ã‚¤ãƒ¼ãƒˆï¼ˆãƒ¡ãƒ‡ã‚£ã‚¢å«ã‚€ï¼‰ã‚’å–å¾—ã—ã¾ã™ã€‚",
      "position": [
        288,
        256
      ],
      "parameters": {
        "url": "={{ 'https://api.twitter.com/2/users/' + $json.data.id + '/tweets?max_results=10&tweet.fields=attachments&expansions=attachments.media_keys&media.fields=type,url,variants' }}",
        "options": {}
      },
      "typeVersion": 4.2
    },
    {
      "id": "69b14da0-3280-4c55-bc50-c4b7f355af23",
      "name": "Filter Video Tweets",
      "type": "n8n-nodes-base.code",
      "notes": "å‹•ç”»ãƒ¡ãƒ‡ã‚£ã‚¢ã®ã¿æŠ½å‡ºã—ã¾ã™ã€‚",
      "position": [
        512,
        256
      ],
      "parameters": {
        "jsCode": "const tweets = $input.first().json.data || [];\nconst includes = $input.first().json.includes || {};\nconst media = includes.media || [];\nconst out = [];\nfor (const t of tweets) {\n  const keys = (t.attachments && t.attachments.media_keys) || [];\n  const hasVideo = keys.some(k => (media.find(m => m.media_key===k) || {}).type === 'video');\n  if (hasVideo) {\n    out.push({ tweet_id: t.id, text: t.text, url: `https://twitter.com/i/status/${t.id}` });\n  }\n}\nreturn out;"
      },
      "typeVersion": 2
    },
    {
      "id": "5ae1e3f9-4821-41ea-b88e-c9041d7a933a",
      "name": "Check Existing URLs",
      "type": "n8n-nodes-base.googleSheets",
      "notes": "å±¥æ­´ç®¡ç†ã®ãŸã‚ã‚·ãƒ¼ãƒˆã«è¿½è¨˜ã—ã¾ã™ã€‚",
      "position": [
        736,
        256
      ],
      "parameters": {
        "columns": {
          "value": {
            "URL": "={{ $json.url }}",
            "æ–‡ç« ": "={{ $json.text }}",
            "ãƒ„ã‚¤ãƒ¼ãƒˆID": "={{ $json.tweet_id }}"
          },
          "schema": [
            {
              "id": "ãƒ„ã‚¤ãƒ¼ãƒˆID",
              "type": "string",
              "displayName": "ãƒ„ã‚¤ãƒ¼ãƒˆID",
              "canBeUsedToMatch": true
            },
            {
              "id": "æ–‡ç« ",
              "type": "string",
              "displayName": "æ–‡ç« ",
              "canBeUsedToMatch": true
            },
            {
              "id": "URL",
              "type": "string",
              "displayName": "URL",
              "canBeUsedToMatch": true
            },
            {
              "id": "setURL",
              "type": "string",
              "displayName": "setURL",
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [
            "row_number"
          ]
        },
        "options": {},
        "operation": "append",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 89155752,
          "cachedResultName": "æ›´æ–°æƒ…å ±"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "19pJoBuba1o2PaJlx0inaGnGi45PpxbfB79MMhwLFH4s",
          "cachedResultName": "1.æŠ•ç¨¿è‡ªå‹•åé›†"
        }
      },
      "typeVersion": 4.5
    },
    {
      "id": "d974879e-f343-4375-b521-4ff6f5780a9e",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "notes": "URL ã‚’å¼•ç”¨å‹•ç”»å½¢å¼ã¸å¤‰æ›ã—ã¾ã™ã€‚",
      "position": [
        960,
        256
      ],
      "parameters": {
        "options": {},
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "=setURL",
              "type": "string",
              "value": "={{ $json.URL }}/video/1"
            }
          ]
        }
      },
      "typeVersion": 3.4
    },
    {
      "id": "325148aa-46c7-447c-badf-5193c567e622",
      "name": "Append or update row in sheet",
      "type": "n8n-nodes-base.googleSheets",
      "notes": "setURL ã‚’ upsert ã—ã¾ã™ã€‚",
      "position": [
        1184,
        256
      ],
      "parameters": {
        "columns": {
          "value": {
            "setURL": "={{ $json.setURL }}",
            "ãƒ„ã‚¤ãƒ¼ãƒˆID": "={{ $('Check Existing URLs').item.json['ãƒ„ã‚¤ãƒ¼ãƒˆID'] }}"
          },
          "schema": [
            {
              "id": "ãƒ„ã‚¤ãƒ¼ãƒˆID",
              "type": "string",
              "displayName": "ãƒ„ã‚¤ãƒ¼ãƒˆID",
              "canBeUsedToMatch": true
            },
            {
              "id": "setURL",
              "type": "string",
              "displayName": "setURL",
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [
            "ãƒ„ã‚¤ãƒ¼ãƒˆID"
          ]
        },
        "options": {},
        "operation": "appendOrUpdate",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 89155752,
          "cachedResultName": "æ›´æ–°æƒ…å ±"
        },
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "=19pJoBuba1o2PaJlx0inaGnGi45PpxbfB79MMhwLFH4s"
        }
      },
      "typeVersion": 4.7
    },
    {
      "id": "380ba318-3a78-488e-9b63-4f820a56d568",
      "name": "Check New Videos",
      "type": "n8n-nodes-base.if",
      "notes": "æœªå®Œäº†ã®ã¿æ¬¡ã¸æµã—ã¾ã™ã€‚",
      "position": [
        1408,
        256
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 1,
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "1",
              "operator": {
                "type": "string",
                "operation": "notEqual"
              },
              "leftValue": "={{ $('Append or update row in sheet').item.json['é”æˆçŠ¶æ³'] || '' }}",
              "rightValue": "å®Œäº†"
            }
          ]
        }
      },
      "typeVersion": 2
    },
    {
      "id": "5c7f361a-2e63-4eca-9107-a8d7135194f3",
      "name": "Generate Tweet Text",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "notes": "AI ãŒæŠ•ç¨¿æ–‡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚",
      "position": [
        1632,
        256
      ],
      "parameters": {
        "text": "={{ $json.text }}\n\nã“ã®å†…å®¹ã«åŸºã¥ã„ã¦ã€é­…åŠ›çš„ãªæŠ•ç¨¿æ–‡ã‚’æ—¥æœ¬èªã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\nä»¥ä¸‹ã®è¦ç´ ã‚’å«ã‚ã¦ãã ã•ã„ï¼š\n- ç°¡æ½”ã§èˆˆå‘³ã‚’å¼•ãèª¬æ˜\n- é©åˆ‡ãªãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆ3-5å€‹ï¼‰\n- ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚’ä¿ƒã™è¦ç´ \n\næ–‡å­—æ•°ã¯100-150æ–‡å­—ç¨‹åº¦ã§ã€æœ€å¾Œã«å‹•ç”»URLã‚’é…ç½®ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚",
        "options": {
          "systemMessage": "ã‚ãªãŸã¯ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆã®å°‚é–€å®¶ã§ã™ã€‚æä¾›ã•ã‚ŒãŸå†…å®¹ã‹ã‚‰é­…åŠ›çš„ã§å…±æœ‰ã•ã‚Œã‚„ã™ã„æŠ•ç¨¿æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"
        },
        "promptType": "define"
      },
      "typeVersion": 2
    },
    {
      "id": "44c907e2-890c-4d6e-beb4-34c0bfc22e8d",
      "name": "Post to X",
      "type": "n8n-nodes-base.twitter",
      "notes": "è‡ªå‹•ã§ X ã«æŠ•ç¨¿ã—ã¾ã™ã€‚",
      "position": [
        1984,
        256
      ],
      "parameters": {
        "text": "={{ $json.output }}\n\n{{ $('Append or update row in sheet').item.json.setURL }}",
        "additionalFields": {}
      },
      "typeVersion": 2
    },
    {
      "id": "16e954d5-8e49-43f8-94a1-90b867531bdc",
      "name": "Update Spreadsheet",
      "type": "n8n-nodes-base.googleSheets",
      "notes": "æŠ•ç¨¿å®Œäº†ã‚’ãƒãƒ¼ã‚¯ã—ã¾ã™ã€‚",
      "position": [
        2208,
        256
      ],
      "parameters": {
        "columns": {
          "value": {
            "é”æˆçŠ¶æ³": "å®Œäº†",
            "ãƒ„ã‚¤ãƒ¼ãƒˆID": "={{ $('Append or update row in sheet').item.json['ãƒ„ã‚¤ãƒ¼ãƒˆID'] }}"
          },
          "mappingMode": "defineBelow",
          "matchingColumns": [
            "ãƒ„ã‚¤ãƒ¼ãƒˆID"
          ]
        },
        "options": {},
        "operation": "appendOrUpdate",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 89155752,
          "cachedResultName": "æ›´æ–°æƒ…å ±"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "19pJoBuba1o2PaJlx0inaGnGi45PpxbfB79MMhwLFH4s"
        }
      },
      "typeVersion": 4.5
    },
    {
      "id": "ea0648dc-eda5-417c-a3e1-d5ca7b925c20",
      "name": "OpenRouter Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "notes": "LLM ã®è³‡æ ¼æƒ…å ±ã‚’å‚ç…§ã—ã¾ã™ã€‚",
      "position": [
        1696,
        480
      ],
      "parameters": {
        "options": {}
      },
      "typeVersion": 1
    },
    {
      "id": "f850486d-8ec9-4a1a-842e-46ca8a92c1b2",
      "name": "ğŸŸ¨ Sticky: Overview",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -704,
        32
      ],
      "parameters": {
        "color": "yellow",
        "width": 396,
        "height": 260,
        "content": "## Template Overview (Read Me First)\n**Purpose**: Fetch recent X videos from a target user, generate a fresh caption with AI, and auto-post to your X account. All runs are logged to Google Sheets for deduping & auditing.\n\n### Requirements\n- X (Twitter) OAuth2 credential\n- Google Sheets OAuth2 credential\n- OpenRouter credential (LLM)\n\n### Flow\n1) Schedule â†’ 2) Get user.id â†’ 3) Get tweets (with media) â†’ 4) Filter videos â†’ 5) Append to Sheet â†’\n6) Build shareable `setURL` â†’ 7) AI caption â†’ 8) Post to X â†’ 9) Mark `é”æˆçŠ¶æ³=å®Œäº†`.\n\n### Security\n- Never hardcode tokens in HTTP nodesâ€”use **Credentials**.\n- Replace demo Sheet with your own; remove personal IDs before publishing.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "2e27e014-ffbe-4cbb-ba7a-e4ecb7016121",
      "name": "Sticky: Schedule Trigger",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -256,
        -16
      ],
      "parameters": {
        "color": "white",
        "width": 268,
        "height": 260,
        "content": "## Schedule Trigger â€” How to use\n- Polling cadence: e.g., every **1â€“3 hours** (interval) or switch to **Cron** for fine control.\n- Consider API rate limits & off-peak scheduling.\n- For manual runs during tests, click **Execute Workflow**.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "ff7793b2-6ed8-4dd9-8cf9-bf094084beff",
      "name": "Sticky: Get User ID",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        16,
        432
      ],
      "parameters": {
        "color": "white",
        "width": 300,
        "height": 308,
        "content": "## Get User ID (HTTP Request)\n- Endpoint: `/2/users/by/username/:handle` returns `data.id`.\n- **Action**: Replace the hardcoded username with your target handle (or feed it via a Set node / env var).\n- **Creds**: Use **Twitter OAuth2**. Do not paste bearer tokens directly.\n- Output fields used later: `data.id`.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "27854651-0068-49d9-87f8-06f4523bf950",
      "name": "Sticky: Get Tweets with Videos",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        80,
        -48
      ],
      "parameters": {
        "color": "white",
        "width": 380,
        "height": 292,
        "content": "## Get Tweets with Videos (HTTP Request)\n- Endpoint: `/2/users/:id/tweets` with expansions `attachments.media_keys` and `media.fields`.\n- Adjust `max_results` (5â€“20). Add `since_id` or `start_time` if you want stricter deduping.\n- Output contains `data[]`, `includes.media[]` for downstream filtering.\n- Tip: Use `tweet.fields=created_at` if you need time-based rules.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "4f5b8177-7605-40b0-9d7a-b714d21155e0",
      "name": "Sticky: Filter Video Tweets",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        480,
        -16
      ],
      "parameters": {
        "color": "white",
        "width": 300,
        "height": 260,
        "content": "## Filter Video Tweets (Code)\n- Filters items where any attached media has `type === 'video'`.\n- To include GIF videos, also accept `animated_gif`.\n- Emits one item per video tweet with `{ tweet_id, text, url }`.\n- Customize: add language filters, exclude replies/retweets, etc.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "65afa322-a9e1-464b-8cee-1fcccb4222b6",
      "name": "Sticky: Check Existing URLs",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        624,
        432
      ],
      "parameters": {
        "color": "white",
        "width": 396,
        "height": 260,
        "content": "## Check Existing URLs (Google Sheets â€” Append)\n- Appends `{ ãƒ„ã‚¤ãƒ¼ãƒˆID, æ–‡ç« , URL }` to your Sheet to maintain a registry.\n- Replace `documentId/sheetName` with your own copy.\n- Use this sheet to prevent duplicates and enable audit trails.\n- Tip: Add timestamp & account columns for more context.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "b3a11fdc-4781-41db-83d7-4b95cc5bd080",
      "name": "Sticky: Edit Fields",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        880,
        0
      ],
      "parameters": {
        "color": "white",
        "width": 284,
        "height": 260,
        "content": "## Edit Fields (Set)\n- Builds `setURL = {{URL}}/video/1` to point to the video playback UI.\n- This is optimized for native X videos; external links may require custom rules.\n- You can add UTM params here for analytics (e.g., `?utm_source=n8n`).\n"
      },
      "typeVersion": 1
    },
    {
      "id": "a34e1c1d-e631-4de1-baad-818a28dad740",
      "name": "Sticky: Append/Update (setURL)",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1136,
        480
      ],
      "parameters": {
        "color": "white",
        "width": 332,
        "height": 260,
        "content": "## Append or update row in sheet (Google Sheets â€” Upsert)\n- Upserts `setURL` by key `ãƒ„ã‚¤ãƒ¼ãƒˆID` (**matchingColumns**).\n- Ensures the shareable URL is stored for posting and logging.\n- Remove real Sheet IDs before publishing a public template.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "064badd6-d0e8-411c-9170-e814952123c0",
      "name": "Sticky: Check New Videos",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1280,
        -32
      ],
      "parameters": {
        "color": "white",
        "width": 284,
        "height": 260,
        "content": "## Check New Videos (IF)\n- Condition: proceed only when `é”æˆçŠ¶æ³` is not `'å®Œäº†'` (or row missing).\n- This prevents reposting the same tweet repeatedly.\n- Customize: add checks like age (`created_at`) or language before posting.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "9d337b5b-8b19-4702-9119-c70f3ab977a6",
      "name": "Sticky: OpenRouter Chat Model",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1600,
        608
      ],
      "parameters": {
        "color": "white",
        "width": 348,
        "height": 260,
        "content": "## OpenRouter Chat Model (Credential)\n- Select model (cost/quality tradeoff). Examples: `gpt-4o-mini`, etc.\n- Configure **OpenRouter** credentials in n8n â†’ Credentials.\n- Optional: set retry rules in workflow settings for robustness.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "3204d240-cf45-421b-8f37-43b2aede2bf7",
      "name": "Sticky: Generate Tweet Text",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1600,
        -32
      ],
      "parameters": {
        "color": "white",
        "width": 268,
        "height": 260,
        "content": "## Generate Tweet Text (AI Agent)\n- Prompt: 100â€“150 chars, 3â€“5 hashtags, and an engagement CTA in Japanese.\n- Provide brand voice via constants (Set node) or via the Sheet.\n- Add compliance rules as needed (e.g., disclaimers, ç¦æ­¢èªè¾æ›¸).\n"
      },
      "typeVersion": 1
    },
    {
      "id": "f26c937b-e425-4e59-bcc6-4e3b3d63145e",
      "name": "Sticky: Post to X",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1920,
        -16
      ],
      "parameters": {
        "color": "white",
        "width": 252,
        "height": 260,
        "content": "## Post to X (Twitter)\n- Posts `output` from AI plus the `setURL` generated earlier.\n- Test with a sandbox account to validate formatting & line breaks.\n- Consider adding a **dry-run** boolean to skip posting during tests.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "96c75931-3078-40b8-a730-8ae0f4e005e3",
      "name": "Sticky: Update Spreadsheet",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2192,
        400
      ],
      "parameters": {
        "color": "white",
        "width": 252,
        "height": 276,
        "content": "## Update Spreadsheet (Google Sheets)\n- Upserts `é”æˆçŠ¶æ³ = å®Œäº†` for the posted `ãƒ„ã‚¤ãƒ¼ãƒˆID`.\n- Add a `posted_at` timestamp and `posted_text` columns for complete logs.\n- This supports idempotency and future analytics.\n"
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1068413b-38d0-45c7-ac4f-81edd645b61a",
  "connections": {
    "Post to X": {
      "main": [
        [
          {
            "node": "Update Spreadsheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User ID": {
      "main": [
        [
          {
            "node": "Get Tweets with Videos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check New Videos": {
      "main": [
        [
          {
            "node": "Generate Tweet Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get User ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Existing URLs": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Video Tweets": {
      "main": [
        [
          {
            "node": "Check Existing URLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Tweet Text": {
      "main": [
        [
          {
            "node": "Post to X",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Generate Tweet Text",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get Tweets with Videos": {
      "main": [
        [
          {
            "node": "Filter Video Tweets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Check New Videos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}