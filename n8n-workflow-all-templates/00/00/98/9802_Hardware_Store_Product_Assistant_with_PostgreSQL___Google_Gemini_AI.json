{
  "id": "KN9jNN3EZPjpNGbC",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Hardware Store Product Assistant with PostgreSQL & Google Gemini AI",
    "wechat": "youandme10086",
    "id": 9802,
    "update_time": "2025-11-10"
  },
  "name": "AI Agent with PostgreSQL & MCP for Hardware Store Chatbot",
  "tags": [],
  "nodes": [
    {
      "id": "fbc411f2-3338-4a02-b72d-ab543374fbfc",
      "name": "Database Tools Trigger",
      "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
      "position": [
        -464,
        368
      ],
      "webhookId": "99ec287f-b754-4cb9-a91f-b302c1195ee9",
      "parameters": {
        "path": "servidorbasesdedatos"
      },
      "typeVersion": 2
    },
    {
      "id": "01e12dad-723e-4363-94e4-6e44b0850ba1",
      "name": "Query Product by ID",
      "type": "n8n-nodes-base.postgresTool",
      "position": [
        -640,
        512
      ],
      "parameters": {
        "table": {
          "__rl": true,
          "mode": "list",
          "value": "productos",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}",
              "column": "id"
            }
          ]
        },
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "options": {},
        "operation": "select",
        "combineConditions": "OR"
      },
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      },
      "typeVersion": 2.6
    },
    {
      "id": "4ccc8c2d-3300-43cf-8ce2-cd919489fedb",
      "name": "Query Product by Name",
      "type": "n8n-nodes-base.postgresTool",
      "position": [
        -448,
        560
      ],
      "parameters": {
        "table": {
          "__rl": true,
          "mode": "list",
          "value": "productos",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}",
              "column": "nombre"
            }
          ]
        },
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "options": {},
        "operation": "select",
        "combineConditions": "OR"
      },
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      },
      "typeVersion": 2.6
    },
    {
      "id": "8e9ffd6e-8b31-4c2a-b3ee-8ba4e7539469",
      "name": "Query Product by Description",
      "type": "n8n-nodes-base.postgresTool",
      "position": [
        -320,
        624
      ],
      "parameters": {
        "table": {
          "__rl": true,
          "mode": "list",
          "value": "productos",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}",
              "column": "descripcion"
            }
          ]
        },
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "options": {},
        "operation": "select",
        "combineConditions": "OR"
      },
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      },
      "typeVersion": 2.6
    },
    {
      "id": "1a18188f-33a6-47bf-881f-d5fd4a263af5",
      "name": "Query Product by Category",
      "type": "n8n-nodes-base.postgresTool",
      "position": [
        -208,
        528
      ],
      "parameters": {
        "table": {
          "__rl": true,
          "mode": "list",
          "value": "productos",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}",
              "column": "categoria"
            }
          ]
        },
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "options": {},
        "operation": "select",
        "combineConditions": "OR"
      },
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      },
      "typeVersion": 2.6
    },
    {
      "id": "4a7b5cdf-8ada-432d-b12c-b991528c66e1",
      "name": "Query Product by Subcategory",
      "type": "n8n-nodes-base.postgresTool",
      "position": [
        -64,
        496
      ],
      "parameters": {
        "table": {
          "__rl": true,
          "mode": "list",
          "value": "productos",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}",
              "column": "subcategoria"
            }
          ]
        },
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "options": {},
        "operation": "select",
        "combineConditions": "OR"
      },
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      },
      "typeVersion": 2.6
    },
    {
      "id": "88060128-1221-44aa-816c-ae256e9683fe",
      "name": "Query Product by Note",
      "type": "n8n-nodes-base.postgresTool",
      "position": [
        -112,
        352
      ],
      "parameters": {
        "table": {
          "__rl": true,
          "mode": "list",
          "value": "productos",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}",
              "column": "nota"
            }
          ]
        },
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "options": {},
        "operation": "select",
        "combineConditions": "OR"
      },
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      },
      "typeVersion": 2.6
    },
    {
      "id": "e9398c88-b894-4a3e-9c98-ce2347bfe967",
      "name": "Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        -112,
        112
      ],
      "webhookId": "5cb3512c-5ed5-405e-a754-170e8edfaccb",
      "parameters": {
        "public": true,
        "options": {
          "allowFileUploads": true,
          "showWelcomeScreen": true
        }
      },
      "typeVersion": 1.3
    },
    {
      "id": "fdaba65d-ebd9-40cf-8041-cb3b59de0a0f",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        256,
        112
      ],
      "parameters": {
        "options": {
          "systemMessage": "Eres un asistente de ventas especializado en materiales de construcci칩n para sistemas de drywall, plafones y acabados. Tu objetivo es ayudar a los clientes a encontrar productos, generar cotizaciones y asesorar en proyectos de construcci칩n.\nTu Rol y Responsabilidades\n\nAsesor experto: Conoces profundamente los productos de tablaroca, perfiles met치licos, torniller칤a, acabados y sistemas de cielos falsos\nConsultor de proyectos: Ayudas a calcular materiales necesarios para proyectos espec칤ficos\nGenerador de cotizaciones: Proporcionas precios claros y totales detallados\nEducador: Explicas el uso correcto de cada producto y sus aplicaciones\n\nAcceso a Informaci칩n de Productos\nTienes acceso a una base de datos PostgreSQL con la tabla productos que contiene:\n\nid: Identificador 칰nico del producto\nnombre: Nombre comercial del producto\ndescripcion: Descripci칩n detallada y usos\nmedida_unidad: Unidad de venta (pza, rollo, cubeta, kg)\ndimensiones: Medidas f칤sicas del producto\nexistencia: Cantidad disponible en inventario\nprecio_unidad: Precio por unidad en pesos mexicanos\ncategoria: Clasificaci칩n principal (Paneles, Perfiles Met치licos, Torniller칤a, Acabados, Aislamientos, Ferreter칤a)\nsubcategoria: Clasificaci칩n espec칤fica\nrelacionados: IDs de productos complementarios\nnota: Informaci칩n adicional importante\n\nC칩mo Usar la Herramienta MCP Client\nPuedes consultar productos usando diferentes criterios:\n\nPor ID: Cuando conozcas el n칰mero exacto del producto\nPor nombre: Para b칰squedas por nombre comercial (ej: \"Tablaroca\", \"Canal\", \"Pija\")\nPor descripci칩n: Para b칰squedas m치s generales sobre caracter칤sticas\nPor categor칤a: Para listar productos por tipo (Paneles, Perfiles Met치licos, Torniller칤a, etc.)\nPor subcategor칤a: Para b칰squedas m치s espec칤ficas (Tablaroca, Canales, Postes, etc.)\nPor nota: Para informaci칩n t칠cnica espec칤fica\n\nGu칤as de Conversaci칩n\nConsultas de Productos\nCuando un cliente pregunte por un producto:\n\nBusca en la base de datos usando el criterio m치s apropiado\nProporciona nombre, descripci칩n, precio y disponibilidad\nMenciona productos relacionados que puedan complementar la compra\nIncluye notas t칠cnicas relevantes (medidas, calibres, aplicaciones)\n\nCotizaciones\nAl generar cotizaciones:\n\nLista cada producto con su nombre completo\nIndica cantidad solicitada y unidad de medida\nMuestra precio unitario y subtotal por producto\nCalcula el total general al final\nMenciona disponibilidad en existencias\nFormato claro y profesional\n\nEjemplo de cotizaci칩n:\nCOTIZACI칍N\n\n1. Tablaroca Ultralight USG (1.22 x 2.44 m x 1/2\")\n   - Cantidad: 20 piezas\n   - Precio unitario: $240.00\n   - Subtotal: $4,800.00\n   \n2. Canal 6.35 Cal 26 (3.05 m)\n   - Cantidad: 10 piezas\n   - Precio unitario: $62.00\n   - Subtotal: $620.00\n\nTOTAL: $5,420.00\n\nNota: Verificar disponibilidad en inventario\nAsesor칤a para Proyectos\nCuando un cliente describa un proyecto (ej: \"quiero hacer un muro divisorio de 4x3 metros\"):\n\nIdentifica el tipo de proyecto: muro divisorio, cielo falso, 치rea h칰meda\nCalcula materiales necesarios:\n\nPaneles seg칰n 치rea a cubrir (cada Tablaroca cubre ~2.97 m)\nPerfiles met치licos seg칰n dimensiones y separaci칩n est치ndar\nTorniller칤a seg칰n cantidad de paneles y uniones\nAcabados proporcionales al 치rea\n\n\nRecomienda productos complementarios:\n\nAislamiento para mejor confort\nProductos relacionados seg칰n el tipo de proyecto\n\n\nProporciona cantidades aproximadas basadas en:\n\nPostes cada 40.6 o 61 cm\nPijas: aproximadamente 32 por panel de Tablaroca\nCompuesto: 1 cubeta de 21.8 kg cubre ~30-40 m de junta\nCinta: 1 rollo de 76 m cubre ~20-25 paneles\n\n\nGenera cotizaci칩n completa con todos los materiales\n\n츼reas H칰medas\nPara ba침os o cocinas, recomienda:\n\nDurock en lugar de Tablaroca tradicional\nPijas especiales para Durock (resistentes a corrosi칩n)\nBasecoat USG para mejor acabado en paneles cementicios\n\nCielos Falsos/Plafones\nPara proyectos de cielos falsos, incluye:\n\nPerfiles principales (Canaleta de carga, Tee principal)\nPerfiles secundarios (Canal list칩n, Tee 1.22, Tee 61)\nAcabados perimetrales (츼ngulo de amarre, 츼ngulo perimetral)\nPaneles de plaf칩n (61x61 cm)\nSistema de suspensi칩n (Alambre galvanizado)\n\nTono y Estilo\n\nProfesional pero cercano: Habla como un experto accesible\nClaro y directo: Evita tecnicismos innecesarios, explica cuando sea necesario\nProactivo: Sugiere productos complementarios y alternativas\nEducativo: Explica para qu칠 sirve cada producto y c칩mo se usa\nPreciso con n칰meros: Verifica c치lculos y proporciona cotizaciones exactas\n\nInformaci칩n Importante\n\nTodos los precios est치n en pesos mexicanos (MXN)\nSiempre verifica la existencia antes de confirmar disponibilidad\nSi un producto tiene existencia = 0, indica que est치 agotado y ofrece alternativas\nUsa las notas de cada producto para dar informaci칩n t칠cnica valiosa\nConsidera los productos relacionados para ventas complementarias\n\nLimitaciones\n\nNo inventes informaci칩n que no est칠 en la base de datos\nSi no encuentras un producto, ofr칠cete a buscar por otros t칠rminos\nNo garantices tiempos de entrega ni pol칤ticas de devoluci칩n (eso lo maneja el 치rea administrativa)\nPara consultas sobre instalaci칩n compleja, sugiere contactar a un profesional\n\n\nObjetivo Final: Proporcionar una experiencia de compra informada, ayudar a los clientes a encontrar exactamente lo que necesitan y asegurar que tengan todos los materiales para completar exitosamente sus proyectos."
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "3876074c-a9fd-4802-8b4c-8c1c7f3178d2",
      "name": "Language Model (Google Gemini)",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        128,
        304
      ],
      "parameters": {
        "options": {}
      },
      "credentials": {
        "googlePalmApi": {
          "id": "OMOVcwsquEQ2tLh5",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "b93eaac2-2de5-425a-800c-07dfcca60afb",
      "name": "Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        288,
        336
      ],
      "parameters": {
        "contextWindowLength": 50
      },
      "typeVersion": 1.3
    },
    {
      "id": "c247fa37-e815-4fbb-a954-98bf247527d5",
      "name": "DB Tools Client",
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "position": [
        448,
        336
      ],
      "parameters": {
        "options": {},
        "endpointUrl": "http://localhost:5678/mcp/servidorbasesdedatos"
      },
      "typeVersion": 1.1
    },
    {
      "id": "8f1238d5-d0a0-4981-a236-fd5a58a83d68",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1088,
        0
      ],
      "parameters": {
        "color": 4,
        "width": 352,
        "height": 736,
        "content": "## 游닇 Descripci칩n del Flujo / Workflow Description\n\nEste agente de IA conversacional responde preguntas sobre productos de ferreter칤a. Utiliza un modelo de lenguaje de Google (Gemini) y se conecta a una base de datos PostgreSQL en tiempo real usando el **MCP Client Tool** para obtener la informaci칩n.\n\n**Funcionalidades Principales:**\n- **Consultas de productos:** por ID, nombre, categor칤a, etc.\n- **Asesoramiento:** sobre materiales para proyectos.\n- **Generaci칩n de cotizaciones** detalladas.\n\n---\n\nThis conversational AI agent answers questions about hardware store products. It uses a Google language model (Gemini) and connects to a PostgreSQL database in real-time using the **MCP Client Tool** to get the information.\n\n**Main Features:**\n- **Product queries:** by ID, name, category, etc.\n- **Advice:** on materials for projects.\n- **Generation** of detailed quotes."
      },
      "typeVersion": 1
    },
    {
      "id": "93ca2a57-7d7b-43ff-ac50-cfa3514217bc",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        608,
        32
      ],
      "parameters": {
        "color": 5,
        "width": 352,
        "height": 768,
        "content": "## 丘뙖잺 Configuraci칩n Requerida / Required Configuration\n\nPara que este flujo funcione, aseg칰rate de configurar lo siguiente:\n\n1.  **Credenciales de PostgreSQL:**\n    - Deben estar configuradas y seleccionadas en cada nodo `PostgresTool`.\n\n2.  **Credenciales de Google Gemini:**\n    - Deben estar configuradas en el nodo `Language Model (Google Gemini)`.\n\n---\n\nFor this workflow to run, make sure to set up the following:\n\n1.  **PostgreSQL Credentials:**\n    - Must be configured and selected in each `PostgresTool` node.\n\n2.  **Google Gemini Credentials:**\n    - Must be configured in the `Language Model (Google Gemini)` node."
      },
      "typeVersion": 1
    },
    {
      "id": "06499bb5-76aa-40c6-b6ee-44b0e1aa3d1c",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -672,
        -112
      ],
      "parameters": {
        "width": 1248,
        "height": 176,
        "content": "## AI Agent with PostgreSQL & MCP for Hardware Store Chatbot\n\nA conversational AI agent workflow in n8n powered by Google Gemini. It connects to a PostgreSQL database via the MCP Client tool to handle real-time product queries for a hardware store.\n\n---\n\n## Agente IA con PostgreSQL y MCP para Chatbot de Ferreter칤a\n\nFlujo de trabajo en n8n de un agente de IA conversacional impulsado por Google Gemini. Se conecta a una base de datos PostgreSQL a trav칠s de la herramienta MCP Client para gestionar consultas de productos en tiempo real para una ferreter칤a."
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "482bcc14-4176-4f7e-845f-526daf162329",
  "connections": {
    "Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DB Tools Client": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by ID": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Name": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Note": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Category": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Description": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Subcategory": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Language Model (Google Gemini)": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  }
}