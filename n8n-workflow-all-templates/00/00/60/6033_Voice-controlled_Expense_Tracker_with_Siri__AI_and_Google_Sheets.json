{
  "id": "VMjotXgKnVGgXh6r",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Voice-controlled Expense Tracker with Siri, AI and Google Sheets",
    "wechat": "youandme10086",
    "id": 6033,
    "update_time": "2025-11-10"
  },
  "name": "Siri AI Finance Assistant",
  "tags": [],
  "nodes": [
    {
      "id": "a763521a-d20a-4e62-89e8-7d80687d2cc9",
      "name": "Recieve",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -200,
        0
      ],
      "webhookId": "a80191e2-2219-4157-a686-fe478130a27f",
      "parameters": {
        "path": "a80191e2-2219-4157-a686-fe478130a27f",
        "options": {},
        "httpMethod": "POST",
        "responseMode": "responseNode"
      },
      "typeVersion": 2
    },
    {
      "id": "8981afa4-741d-41a0-b36e-0e88fd7843d6",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        360,
        0
      ],
      "parameters": {
        "text": "={{ $json.raw_input }}",
        "options": {
          "systemMessage": "=## Overview\n\nYou are the userâ€™s personal finance assistant. Your job is to determine whether the userâ€™s input is for recording a transaction or reading account history, and call the correct tool accordingly. You should never ask the user for duplicate details â€” infer when possible and proceed with the appropriate tool call. \n\n**Must response in Hong Kong Chinese version\n\n###Tools\n\nUse these tools:\n\tâ€¢\tAppend: Use this tool to record new expenses or income.\n\tâ€¢\tRead: Use this tool to read and summarize spending records based on time range or category.\n\n###  Instructions\n\t1.\tFirst, check todayâ€™s date: {{ $now }}\n\t2.\tThen, analyze the user input from: {{ $json.raw_input }}\n\t3.\tDecide whether itâ€™s a write or read task.\n\t4.\tSend the properly formatted payload to the corresponding tool.\n\nIf the user does not specify date, category, or income/expense type, make reasonable assumptions without asking again.\n\n#### Write Example (Append)\n\nUser says: ã€Œæˆ‘é ­å…ˆé£Ÿéº¥ç•¶å‹ç”¨äº†52èšŠã€\nâ†’ Use tool: Append\nâ†’ Send Format:\n```json\n{\n  \"Date\": \"2025-07-12\",\n  \"Type\": \"Food\",\n  \"Name\": \"Lunch (McDonald's)\",\n  \"Amount\": 52.00,\n  \"expenses/incomes\": \"Expense\",\n  \"created time\": \"2025-07-12T14:30:00\"\n}\n```\nâ†’ Reply:\nå·²è¨˜éŒ„æ”¯å‡ºï¼šé …ç›®ã€Œåˆé¤ï¼ˆéº¥ç•¶å‹ï¼‰ã€åˆ†é¡ã€Œé£²é£Ÿã€ï¼Œé‡‘é¡ $52ï¼Œå·²å¯«å…¥ã€‚\n\nâ¸»\n\n#### Read Example (Read)\n\nUser says: ã€Œå¹«æˆ‘æŸ¥éå»ä¸€æ˜ŸæœŸçš„é–‹æ”¯ã€\nâ†’ Use tool: Read\nâ†’ After reading data, reply:\néå» 7 æ—¥ä½ çš„æ”¯å‡ºç¸½é¡ç‚º $250ï¼ŒåŒ…æ‹¬ï¼š7/8 åœ°éµ $14ã€7/10 å·´å£« $21ã€7/11 çš„å£« $215ã€‚\n\nâ¸»\n\n#### Rules\n\tâ€¢\tAlways call the tool, never just return plain JSON or text.\n\tâ€¢\tUse numerical values only for money.\n\tâ€¢\tMust response in Hong Kong Chinese version\n   â€¢    Group records by monthly page (e.g., â€œ07/2025â€).\n\tâ€¢\tKeep replies brief and human-readable.\n\tâ€¢\tDo not ask the user to confirm inferred values unless absolutely necessary.\n\n"
        },
        "promptType": "define"
      },
      "typeVersion": 1.9
    },
    {
      "id": "6acbd90d-80e7-4280-a6af-815fab5ccef9",
      "name": "OpenRouter Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "position": [
        200,
        220
      ],
      "parameters": {
        "model": "google/gemini-2.0-flash-lite-001",
        "options": {
          "maxTokens": -1
        }
      },
      "credentials": {
        "openRouterApi": {
          "id": "un6KB7BYeIzg3yR9",
          "name": "HanamiAIfree"
        }
      },
      "typeVersion": 1
    },
    {
      "id": "41fc8d6a-b550-4f4e-99c7-febad18d7044",
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        920,
        0
      ],
      "parameters": {
        "options": {},
        "respondWith": "allIncomingItems"
      },
      "typeVersion": 1.2
    },
    {
      "id": "ce2f86f7-3246-4582-9d1d-3e12420308ed",
      "name": "Append",
      "type": "n8n-nodes-base.googleSheetsTool",
      "position": [
        520,
        320
      ],
      "parameters": {
        "columns": {
          "value": {
            "Date": "={{ $fromAI('Date', ``, 'string') }}",
            "Name": "={{ $fromAI('Name', ``, 'string') }}",
            "Type": "={{ $fromAI('Type', ``, 'string') }}",
            "Amount": "={{ $fromAI('Amount', ``, 'string') }}",
            "created time": "={{$now}}",
            "expenses/incomes": "={{ $fromAI('expenses_incomes', ``, 'string') }}"
          },
          "schema": [
            {
              "id": "Date",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "Date",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Type",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "Type",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "Name",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Amount",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "Amount",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "expenses/incomes",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "expenses/incomes",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "created time",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "created time",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {},
        "operation": "append",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1478323734,
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1uZik4myIt4XHGs5fpv6ZEDdczVyaOpMe3vLmtLCy0Zc/edit#gid=1478323734",
          "cachedResultName": "overall"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "1uZik4myIt4XHGs5fpv6ZEDdczVyaOpMe3vLmtLCy0Zc",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1uZik4myIt4XHGs5fpv6ZEDdczVyaOpMe3vLmtLCy0Zc/edit?usp=drivesdk",
          "cachedResultName": "ai_personal_expense"
        },
        "descriptionType": "manual",
        "toolDescription": "Use this tool to record new expenses or income."
      },
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "wWSdSoDCZ7FLnBb3",
          "name": "Angus Account"
        }
      },
      "typeVersion": 4.6
    },
    {
      "id": "90f73019-e193-4e7e-805d-5f2f1f5ade08",
      "name": "Read",
      "type": "n8n-nodes-base.googleSheetsTool",
      "position": [
        680,
        300
      ],
      "parameters": {
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "detectAutomatically"
            }
          }
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1478323734,
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1uZik4myIt4XHGs5fpv6ZEDdczVyaOpMe3vLmtLCy0Zc/edit#gid=1478323734",
          "cachedResultName": "overall"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "1uZik4myIt4XHGs5fpv6ZEDdczVyaOpMe3vLmtLCy0Zc",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1uZik4myIt4XHGs5fpv6ZEDdczVyaOpMe3vLmtLCy0Zc/edit?usp=drivesdk",
          "cachedResultName": "ai_personal_expense"
        },
        "descriptionType": "manual",
        "toolDescription": "Use this tool to read and summarize spending records based on time range or category."
      },
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "wWSdSoDCZ7FLnBb3",
          "name": "Angus Account"
        }
      },
      "typeVersion": 4.6
    },
    {
      "id": "4f597617-55ec-4ba2-84de-53e3ef2fbf01",
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        340,
        260
      ],
      "parameters": {
        "sessionKey": "={{ $json.raw_input }}",
        "sessionIdType": "customKey",
        "contextWindowLength": 3
      },
      "typeVersion": 1.3
    },
    {
      "id": "a9399a79-3327-4c99-8c6d-0fc2de29dfb1",
      "name": "FormatInput",
      "type": "n8n-nodes-base.code",
      "position": [
        60,
        0
      ],
      "parameters": {
        "jsCode": "const body = $json.body || {};\nconst rawInput = body.input || '';\nconst now = new Date();\n\nreturn [\n  {\n    json: {\n      raw_input: rawInput,       // åŸå§‹è¼¸å…¥å¥ï¼Œä¾‹å¦‚ï¼šæˆ‘ä»Šæœé£Ÿæ—©é¤ç”¨å’—$50å¹«æˆ‘å¯«è¿”ä½¢\n      formatted_time: now.toISOString(),  // 2025-07-12T15:32:00.000Z\n      date: now.toISOString().split('T')[0], // 2025-07-12\n      time: now.toTimeString().split(' ')[0], // 15:32:00\n    }\n  }\n];"
      },
      "typeVersion": 2
    },
    {
      "id": "431bab20-a59d-4989-abfe-e5f55282b939",
      "name": "FormatOutput",
      "type": "n8n-nodes-base.code",
      "position": [
        720,
        0
      ],
      "parameters": {
        "jsCode": "// å°‡æ‰€æœ‰è¼¸å‡ºçš„æ›è¡Œç¬¦ç§»é™¤\nconst outputs = items.map(item => {\n  const output = item.json.output || '';\n  return output.replace(/\\n/g, '');\n});\n\n// æ­£ç¢ºå›å‚³æ ¼å¼ï¼Œæ¯ç­† json ä¸€å®šè¦æ˜¯ object\nreturn [\n  {\n    json: {\n      å¸Œå¸Œ: outputs.join('')\n    }\n  }\n];"
      },
      "typeVersion": 2
    },
    {
      "id": "f9f8c609-d126-43e3-8770-c142a67e345f",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -960,
        -140
      ],
      "parameters": {
        "width": 700,
        "height": 2060,
        "content": "SIri AI 2.0 (Finance Assistant Version)\n\nPlease download:\n1. Shortcut\nhttps://www.icloud.com/shortcuts/9848032ea36c434bbdc8cf9631309a81\n2. this n8n workflow\n3. Google Drive API\n\nSteps:\nğŸŒ PART 1: n8n Setup\n\nğŸ§© 1. Create a Webhook Trigger in n8n\n\tâ€¢\tAdd a node: Webhook\n\tâ€¢\tSet HTTP Method: POST\n\tâ€¢\tSet Path: siri-finance\n\tâ€¢\tEnable â€œRespond to Webhookâ€ = âœ…\n\nğŸ§  2. Add AI Agent Node (e.g. OpenAI, Ollama, Gemini)\n\tâ€¢\tUse system prompt like:\n\nYou are a finance assistant. Decide if the user wants to record or read transactions.\nIf it's recording, return a JSON object with date, type, name, amount, and expense/income.\nIf it's reading, return date range and type (Expense/Income).\nAlways reply with a human-friendly summary.\n\n\n\tâ€¢\tInput: {{ $json.text }} (from webhook)\n\tâ€¢\tOutput: structured json.output\n\nğŸ§® 3. (Optional) Add Logic to write to DB / Supabase / Google Sheets\n\tâ€¢\tAppend tool: Adds a new row\n\tâ€¢\tRead tool: Queries past data\n\nğŸ’¬ 4. Add a Function Node to format the final message\n\nconst raw = item.json.output || '';\nconst cleaned = raw\n  .replace(/\\n/g, ' ')\n  .replace(/<br\\s*\\/?>/g, ' ')\n  .replace(/[^\\u4e00-\\u9fa5a-zA-Z0-9\\s\\$ï¼šã€‚ï¼Œâ€œâ€]/g, '')\n  .trim();\nreturn [{ json: { reply: cleaned } }];\n\nğŸ“© 5. Return final reply to Siri\n\tâ€¢\tIn your Webhook Respond Node, set Body:\n\n{{ $json.reply }}\n\nNow your n8n flow is ready!\n\nâ¸»\n\nğŸ“± PART 2: iOS Shortcut Setup\n\nâš™ï¸ 1. Create a new Shortcut\n\tâ€¢\tName it: è¨˜å¸³åŠ©ç† (or Finance Bot)\n\tâ€¢\tAdd Action: Ask for Input\n\tâ€¢\tPrompt: â€œè«‹èªªå‡ºä½ çš„è¨˜å¸³å…§å®¹â€\n\tâ€¢\tInput Type: Text\n\tâ€¢\tAdd Action: Get Contents of URL\n\tâ€¢\tMethod: POST\n\tâ€¢\tURL: https://your-n8n-domain/webhook/siri-finance\n\tâ€¢\tHeaders: Content-Type: application/json\n\tâ€¢\tRequest Body:\n\n{\n  \"text\": \"Provided Input\"\n}\n\n\tâ€¢\tReplace \"Provided Input\" with Magic Variable â†’ Input Result\n\nğŸ”Š 2. Show Result\n\tâ€¢\tAdd Action: Show Result\n\tâ€¢\tContent: Get Contents of URL\n\nğŸ—£ï¸ 3. Optional: Add â€œSpeak Textâ€\n\tâ€¢\tIf you want Siri to speak it back, add Speak Text after Show Result.\n\nâ¸»\n\nâœ… Example Usage\n\tâ€¢\tYou: â€œHey Siri, é–‹æ”¯$50 æ—©é¤â€\n\tâ€¢\tSiri: â€œå·²è¨˜éŒ„æ”¯å‡ºï¼šé …ç›® æ—©é¤ï¼Œé‡‘é¡ $50ï¼Œå·²å¯«å…¥â€\n\nOr\n\tâ€¢\tYou: â€œæŸ¥ä¸€ä¸‹æˆ‘éå»7æ—¥ç”¨äº†å¹¾å¤šéŒ¢â€\n\tâ€¢\tSiri: â€œä½ éå»7æ—¥ç¸½æ”¯å‡ºç‚º $7684.64ï¼ŒåŒ…æ‹¬ï¼šâ‹¯â‹¯â€\n\nâ¸»\n\nğŸ“¦ Files to Share\n\nYou can package the following:\n\tâ€¢\t.shortcut file export\n\tâ€¢\tSample n8n workflow .json\n\tâ€¢\tOptional Supabase schema / Google Sheet template\n\nâ¸»\n\nğŸ’¡ Tips for Newcomers\n\tâ€¢\tKeep your Webhook public but protect with token if needed.\n\tâ€¢\tEnsure you handle emoji and newline safely for iOS compatibility.\n\tâ€¢\tAdd logging nodes in n8n to help debug Siri messages.\n\nâ¸»\n\nğŸ—£ï¸ Optional Project Name\n\nâ€œSiri è¨˜å¸³åŠ©ç†â€ / â€œFinance VoiceBotâ€\n\nA simple voice-first way to manage your daily expenses.\n\n"
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {
    "Recieve": [
      {
        "json": {
          "body": {
            "input": "é£Ÿå’—æ—©é¤$40"
          },
          "query": {},
          "params": {},
          "headers": {
            "host": "webhook.lingumiai.com",
            "accept": "*/*",
            "cf-ray": "95e4feadeedc2647-NRT",
            "cdn-loop": "cloudflare; loops=1",
            "priority": "u=3",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "connection": "keep-alive",
            "user-agent": "BackgroundShortcutRunner/3607.0.2 CFNetwork/3826.500.131 Darwin/24.5.0",
            "cf-ipcountry": "JP",
            "content-type": "application/json",
            "cf-warp-tag-id": "39d521c3-e05a-4548-b17c-ad512cc8f71b",
            "content-length": "27",
            "accept-encoding": "gzip, br",
            "accept-language": "zh-HK,zh-Hant;q=0.9",
            "x-forwarded-for": "138.199.22.149",
            "cf-connecting-ip": "138.199.22.149",
            "x-forwarded-proto": "https"
          },
          "webhookUrl": "http://localhost:5678/webhook/a80191e2-2219-4157-a686-fe478130a27f",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a8f06de3-3118-4a4d-b124-4603ed8b0b25",
  "connections": {
    "Read": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Append": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Recieve": {
      "main": [
        [
          {
            "node": "FormatInput",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "FormatOutput",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FormatInput": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FormatOutput": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  }
}