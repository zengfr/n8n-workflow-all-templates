{
  "id": "Y7rM4PEAHjh3zefB",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Export Dialogflow Intents with Priority Levels to Google Sheets via Telegram",
    "wechat": "youandme10086",
    "id": 7073,
    "update_time": "2025-11-10"
  },
  "name": "Dialogflow Intent Exporter",
  "tags": [],
  "nodes": [
    {
      "id": "2ee1d52e-e143-47e1-b3bc-22d0fd17528e",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "position": [
        64,
        128
      ],
      "webhookId": "d6cbae0c-dc62-4f9e-8098-212bc28bdb51",
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "typeVersion": 1.2
    },
    {
      "id": "4e8fe8a7-13e3-4cd9-9670-6e5a720da072",
      "name": "A√±adir fila en la hoja",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        1600,
        176
      ],
      "parameters": {
        "columns": {
          "value": {
            "Nombre": "={{ $json.Nombre }}",
            "Prioridad": "={{ $json.textoPrioridad }}",
            "Hora de registro": "={{$now.format('HH:mm:ss') }}",
            "Fecha de registro": "={{$now.format('dd/MM/yyyy') }}",
            "Color de prioridad": "={{ $json.colorPrioridad }}",
            "Valor de prioridad": "={{ $json.prioridad }}"
          },
          "schema": [
            {
              "id": "Nombre",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "Nombre",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Prioridad",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Prioridad",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Color de prioridad",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Color de prioridad",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Valor de prioridad",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Valor de prioridad",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Fecha de registro",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Fecha de registro",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Hora de registro",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Hora de registro",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {},
        "operation": "append",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "gid=0",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1v9VHfyEQSWYZxKCMEal0uT5_z6gV1Qx4EIwgr6ShN6E/edit#gid=0",
          "cachedResultName": "intents-nombres"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "1v9VHfyEQSWYZxKCMEal0uT5_z6gV1Qx4EIwgr6ShN6E",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1v9VHfyEQSWYZxKCMEal0uT5_z6gV1Qx4EIwgr6ShN6E/edit?usp=drivesdk",
          "cachedResultName": "Listado-intents"
        }
      },
      "typeVersion": 4.6
    },
    {
      "id": "63227264-c9f0-4c5a-aea1-a22e99ece365",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "parameters": {
        "color": 5,
        "width": 896,
        "height": 480,
        "content": "## Se valida el usuario y comando enviado"
      },
      "typeVersion": 1
    },
    {
      "id": "66dfded1-7af6-45f9-98ae-7fdedd75a644",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        944,
        80
      ],
      "parameters": {
        "width": 496,
        "height": 272,
        "content": "## Se obtiene la informaci√≥n de los intents y se procesa"
      },
      "typeVersion": 1
    },
    {
      "id": "4ebfb516-ff02-4c53-9fee-82676ff3b3eb",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1488,
        80
      ],
      "parameters": {
        "color": 4,
        "width": 576,
        "height": 272,
        "content": "## Registro en Sheets y confirmaci√≥n por Telegram"
      },
      "typeVersion": 1
    },
    {
      "id": "72b44433-2b77-4bc3-a31b-cbc04f3ecfd5",
      "name": "Validaci√≥n de usuario por ID",
      "type": "n8n-nodes-base.if",
      "position": [
        288,
        128
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "3f4c5e75-e48d-450a-896b-4bd396851417",
              "operator": {
                "type": "number",
                "operation": "equals"
              },
              "leftValue": "={{ $json.message.from.id }}",
              "rightValue": 7894561234
            }
          ]
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "ca22c2d9-821a-4f15-8011-2e9f02361cc6",
      "name": "Validaci√≥n del comando",
      "type": "n8n-nodes-base.if",
      "position": [
        480,
        32
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "30b2659a-c708-4cb4-8576-913182ec1e65",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $json.message.text }}",
              "rightValue": "backup"
            }
          ]
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "a383d91d-134c-43c1-b48b-e5d8024ff831",
      "name": "Mensaje de validaci√≥n de comando",
      "type": "n8n-nodes-base.telegram",
      "position": [
        624,
        160
      ],
      "webhookId": "f1bac6b6-3a01-4ce7-9a85-b759f45a7fb7",
      "parameters": {
        "text": "Palabra inv√°lida",
        "chatId": "={{ $json.message.from.id }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "778342fd-e973-4c30-b1d6-6fbd79187c5d",
      "name": "Obtiene datos de los intents",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1040,
        176
      ],
      "parameters": {
        "url": "https://dialogflow.googleapis.com/v2/projects/TU_PROJECT_ID/agent/intents",
        "options": {},
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleApi"
      },
      "typeVersion": 4.2
    },
    {
      "id": "730f58b8-bb78-471b-bde0-ba1a10ee8b24",
      "name": "Mensaje de confirmaci√≥n",
      "type": "n8n-nodes-base.telegram",
      "position": [
        1824,
        176
      ],
      "webhookId": "c97e1e83-3534-48cd-bb57-84e6bf7337f0",
      "parameters": {
        "text": "=¬†Se registraron {{$items(\"A√±adir fila en la hoja\").length}} intents en Google Sheets.",
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "executeOnce": true,
      "typeVersion": 1.2
    },
    {
      "id": "7d18b6fa-39c1-46c4-8578-f90b357f3f36",
      "name": "Mensaje de usuario inv√°lido",
      "type": "n8n-nodes-base.telegram",
      "position": [
        448,
        288
      ],
      "webhookId": "68ff50f6-a0ed-489c-8637-5aede49ab6f9",
      "parameters": {
        "text": "Usuario inv√°lido",
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "d925126b-f8c9-4c68-836b-bfe769c70c57",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -448,
        -272
      ],
      "parameters": {
        "color": 6,
        "width": 352,
        "height": 1008,
        "content": "## üîÑ Flujo explicado\n\n### üéØ Trigger (Telegram)\n- **Se activa autom√°ticamente** al recibir *cualquier mensaje* en el bot de Telegram.\n\n### üõ°Ô∏è Validaci√≥n de Usuario y Comando\n- **Se valida el ID** del usuario remitente. (Reemplaza el nro de 10 d√≠gitos por un id real)\n- **Se verifica** que el mensaje recibido sea exactamente **\"backup\"**.\n- ‚ùå En caso de error, **se env√≠a un mensaje indicando que el usuario o el comando es inv√°lido**.\n\n### üåê Solicitud HTTP a Dialogflow\n- **Se consulta la API de Dialogflow** para obtener todos los intents configurados en el agente.\n\n### üß† Nodo de C√≥digo (JavaScript)\n- **Se transforma el JSON** recibido desde Dialogflow.\n- **Se extraen** los valores `displayName` y `priority` de cada intent.\n- **Se asigna un emoji y texto descriptivo** dependiendo del nivel de prioridad:\n  - üî¥ Highest\n  - üü† High\n  - üîµ Normal\n  - üü¢ Low\n  - üö´ Ignore\n\n### üìÑ Registro en Google Sheets\n- **Se agrega cada intent** como una fila en la hoja de c√°lculo.\n- **Se registran tambi√©n la fecha y hora** de procesamiento.\n\n### ‚úÖ Confirmaci√≥n por Telegram\n- **Se env√≠a un mensaje de confirmaci√≥n** con el total de intents registrados.\n- Este mensaje se env√≠a **una sola vez** usando la opci√≥n `Execute Once`.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "ac3bf08d-e601-445d-9e48-13bb6a676f36",
      "name": "Mapear intents con su prioridad",
      "type": "n8n-nodes-base.code",
      "position": [
        1264,
        176
      ],
      "parameters": {
        "jsCode": "// 1Ô∏è‚É£ Obtenemos el array de intents del primer item recibido por este nodo.\n// Si la propiedad \"intents\" no existe, devolvemos un array vac√≠o para evitar errores.\nconst data = $input.first().json.intents || [];\n\n// 2Ô∏è‚É£ Funci√≥n que eval√∫a la prioridad num√©rica de un intent\n// y devuelve un objeto con:\n//   - emoji: Representaci√≥n visual del nivel de prioridad\n//   - texto: Nombre descriptivo del nivel de prioridad\nfunction obtenerPrioridad(priority) {\n  if (priority >= 1000000) return { emoji: 'üî¥', texto: 'Highest' }; // Prioridad m√°xima\n  if (priority >= 750000)  return { emoji: 'üü†', texto: 'High' };    // Prioridad alta\n  if (priority >= 500000)  return { emoji: 'üîµ', texto: 'Normal' };  // Prioridad normal\n  if (priority >= 250000)  return { emoji: 'üü¢', texto: 'Low' };     // Prioridad baja\n  return { emoji: 'üö´', texto: 'Ignore' };                           // Ignorado o desactivado\n}\n\n// 3Ô∏è‚É£ Recorremos cada intent y lo convertimos en un item compatible con n8n.\n// Cada item incluir√°:\n//   - Nombre: El displayName del intent\n//   - prioridad: Valor num√©rico de la prioridad del intent\n//   - colorPrioridad: Emoji que representa la prioridad\n//   - textoPrioridad: Descripci√≥n textual de la prioridad\nconst intents = data.map(intent => {\n  \n  // Extrae la informaci√≥n de prioridad del intent actual.\n  // Si la propiedad \"priority\" no existe, usamos 0 como valor por defecto para evitar errores.\n  const prioridadInfo = obtenerPrioridad(intent.priority || 0);\n  \n  // Construye el item final que n8n espera: { json: {...} }\n  return {\n    json: {\n      Nombre: intent.displayName,\n      prioridad: intent.priority,\n      colorPrioridad: prioridadInfo.emoji,\n      textoPrioridad: prioridadInfo.texto\n    }\n  };\n});\n\n// 4Ô∏è‚É£ Devolvemos el array de items para que n8n los procese.\n// Cada item ser√° una fila independiente si lo conectas, por ejemplo, a Google Sheets.\nreturn intents;\n"
      },
      "typeVersion": 2
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5b987344-93a5-44ed-a9d7-77206db9ee97",
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Validaci√≥n de usuario por ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "A√±adir fila en la hoja": {
      "main": [
        [
          {
            "node": "Mensaje de confirmaci√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validaci√≥n del comando": {
      "main": [
        [
          {
            "node": "Obtiene datos de los intents",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje de validaci√≥n de comando",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene datos de los intents": {
      "main": [
        [
          {
            "node": "Mapear intents con su prioridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validaci√≥n de usuario por ID": {
      "main": [
        [
          {
            "node": "Validaci√≥n del comando",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje de usuario inv√°lido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mapear intents con su prioridad": {
      "main": [
        [
          {
            "node": "A√±adir fila en la hoja",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}