{
  "id": "jYSZTY25ziYwwCJF",
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Bulk Verify WhatsApp Numbers using Rapiwa API and Google Sheets",
    "wechat": "youandme10086",
    "id": 8555,
    "update_time": "2025-11-10"
  },
  "name": "WhatsApp Bulk Number Verification in Google Sheets Using Unofficial Rapiwa API",
  "tags": [],
  "nodes": [
    {
      "id": "0bd3256d-9adc-4d66-a169-4cefb200429b",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "position": [
        1856,
        560
      ],
      "parameters": {
        "options": {}
      },
      "executeOnce": false,
      "typeVersion": 3
    },
    {
      "id": "af2e3fcb-4a5c-4111-b003-1a6c7b73127d",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "position": [
        3776,
        576
      ],
      "webhookId": "2de0ec8f-094f-4a74-b79c-4b74e28688d8",
      "parameters": {
        "amount": 3
      },
      "typeVersion": 1.1
    },
    {
      "id": "e1f2641c-fb40-42df-b7a7-4e1244ec47c4",
      "name": "Limit",
      "type": "n8n-nodes-base.limit",
      "position": [
        1504,
        560
      ],
      "parameters": {
        "maxItems": 200
      },
      "typeVersion": 1
    },
    {
      "id": "3f96c826-8cef-44ed-a7eb-969091b1e67d",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        -80
      ],
      "parameters": {
        "color": 4,
        "width": 704,
        "height": 2348,
        "content": "# BWhatsApp Bulk Number Verification in Google Sheets Using Unofficial Rapiwa API\n\n## Overview\nThis n8n workflow reads phone numbers from a Google Sheet, cleans and verifies them using the Rapiwa API, and writes verification results back to the sheet. It runs automatically on a schedule and uses batching and delays to avoid rate limits.\n\n---\n\n## What it does\n- Reads rows from a Google Sheet where the Status column is empty or marked \"pending\".\n- Cleans phone numbers (removes +, spaces, and non-digit characters).\n- Verifies each number with Rapiwa (checks if number is on WhatsApp).\n- If verified: marks the row as verified and can proceed to send messages.\n- If not verified: marks the row as unverified and skips sending.\n- Adds short delays and processes rows in batches to reduce throttling risk.\n\n---\n\n## Requirements\n- n8n instance with Google Sheets and HTTP Request nodes available.\n- Google Sheets OAuth2 credentials configured in n8n.\n- Rapiwa account and Bearer YOUR_TOKEN_HERE (store as an n8n HTTP credential).\n- A Google Sheet formatted as described below.\n\n---\n\n## Google Sheet format (recommended)\n\n| WhatsApp No   | Name | Message | Verification | Status |\n|---------------|------|---------|--------------|--------|\n| 8801XXXXXXXXX | John | Hello   | *(empty)*    | pending|\n\nNote: Use international format without \"+\" or spaces (e.g., 8801XXXXXXXXX). Set Status = pending to queue a row for processing.\n\n---\n\n## Setup in n8n — quick steps\n1. **Connect Google Sheets**\n   - Add a Google Sheets node, authenticate, select the document and worksheet.\n   - Configure it to read rows where Status is empty or equals \"pending\".\n\n2. **Batch and loop**\n   - Use SplitInBatches or Limit to process a small number of rows per run (e.g., 5 or 10).\n   - Use a Loop or SplitInBatches node to iterate items one by one.\n\n3. **Clean numbers**\n   - Add a Code node to strip non-digit characters from the WhatsApp No field.\n\n4. **Verify with Rapiwa**\n   - Add an HTTP Request node:\n     - Method: POST\n     - URL: https://app.rapiwa.com/api/verify-whatsapp\n     - Authentication: Bearer YOUR_TOKEN_HERE (use n8n HTTP credential)\n     - Headers: Content-Type: application/json\n     - Body (JSON):\n```json\n{\n  \"number\": \"{{ $json['WhatsApp No'] }}\"\n}\n```\n\n5. **Branch and update**\n   - Add an If node to check the verify response (e.g., response.data.exists).\n   - If verified: update the sheet row with Verification = verified and Status = sent (or leave for message node).\n   - If unverified: update the sheet row with Verification = unverified and Status = not sent.\n\n6. **Delay between sends**\n   - Use a Wait node (e.g., 5 seconds) between items to reduce rate-limit issues.\n\n---\n\n## Notes and best practices\n- Test with a small batch before scaling.\n- Store the Rapiwa token in n8n credentials, not in node fields.\n- Increase Wait delay or reduce batch size if you see rate limits or temporary blocks.\n- Keep the sheet headers consistent; the workflow matches columns by name.\n- Log API responses or errors for troubleshooting.\n\n---\n\n## Optional\n- Add a send-message HTTP Request node (Rapiwa) after verification to send messages.\n- Append successful and failed rows to separate sheets for auditing.\n\n---"
      },
      "typeVersion": 1
    },
    {
      "id": "40db67ed-2517-48c3-8c30-625d5327977e",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [
        2672,
        464
      ],
      "parameters": {
        "options": {},
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "99a8cf5b-869c-410f-93df-4c52f45d6986",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              },
              "leftValue": "={{ $json.data.exists }}",
              "rightValue": "true"
            }
          ]
        }
      },
      "typeVersion": 2.2
    },
    {
      "id": "31ebd467-6231-4613-b2d0-cebc12bce6f5",
      "name": "Fetch All Pending Contacts for Verifing",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        1280,
        560
      ],
      "parameters": {
        "options": {},
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "WA Checked"
            }
          ]
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1774160885,
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1QMvP9WxdE1q8prtUgxO6W6KdGlsGlTdrzxPfsxTkz7U/edit#gid=1774160885",
          "cachedResultName": "whatjet"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "1QMvP9WxdE1q8prtUgxO6W6KdGlsGlTdrzxPfsxTkz7U",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1QMvP9WxdE1q8prtUgxO6W6KdGlsGlTdrzxPfsxTkz7U/edit?usp=drivesdk",
          "cachedResultName": "WhatsApp Contacts"
        }
      },
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "gFH3Wjq6yYqSEAei",
          "name": "Google Sheets"
        }
      },
      "notesInFlow": false,
      "retryOnFail": false,
      "typeVersion": 4.6
    },
    {
      "id": "3c05f88c-b4aa-47f8-99b7-ef7b99569df9",
      "name": "Change State of Rows in Checked",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        3472,
        480
      ],
      "parameters": {
        "columns": {
          "value": {
            "WA Checked": "Checked",
            "row_number": "={{ $('Loop Over Items').item.json.row_number }}",
            "WhatsApp No": "={{ $('Clean WhatsApp Number').item.json['WhatsApp No'] }}",
            "Verified/Unverified": "={{ $json.txt }}"
          },
          "schema": [
            {
              "id": "SL",
              "type": "string",
              "display": true,
              "removed": true,
              "required": false,
              "displayName": "SL",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Name",
              "type": "string",
              "display": true,
              "removed": true,
              "required": false,
              "displayName": "Name",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "WhatsApp No",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "WhatsApp No",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Message",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Message",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Image URL",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Image URL",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "WA Checked",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "WA Checked",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Verified/Unverified",
              "type": "string",
              "display": true,
              "removed": false,
              "required": false,
              "displayName": "Verified/Unverified",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "type": "string",
              "display": true,
              "removed": true,
              "required": false,
              "displayName": "Status",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "type": "number",
              "display": true,
              "removed": false,
              "readOnly": true,
              "required": false,
              "displayName": "row_number",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [
            "row_number"
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {},
        "operation": "update",
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": 1774160885,
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1QMvP9WxdE1q8prtUgxO6W6KdGlsGlTdrzxPfsxTkz7U/edit#gid=1774160885",
          "cachedResultName": "whatjet"
        },
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "1QMvP9WxdE1q8prtUgxO6W6KdGlsGlTdrzxPfsxTkz7U",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1QMvP9WxdE1q8prtUgxO6W6KdGlsGlTdrzxPfsxTkz7U/edit?usp=drivesdk",
          "cachedResultName": "WhatsApp Contacts"
        }
      },
      "typeVersion": 4.6
    },
    {
      "id": "a1068fdc-52d1-4303-9abe-0bc19a6c6cea",
      "name": "Set Status Verified",
      "type": "n8n-nodes-base.code",
      "position": [
        3056,
        384
      ],
      "parameters": {
        "jsCode": "return { txt: \"Verified\" };\n"
      },
      "typeVersion": 2
    },
    {
      "id": "87ce468d-670a-488e-911e-0202146b8959",
      "name": "Set Status Unverified",
      "type": "n8n-nodes-base.code",
      "position": [
        3056,
        576
      ],
      "parameters": {
        "jsCode": "return { txt: \"Unverified\" };\n"
      },
      "typeVersion": 2
    },
    {
      "id": "90480647-7d8c-427d-a53b-7e9a6e0ddcb0",
      "name": "Clean WhatsApp Number",
      "type": "n8n-nodes-base.code",
      "position": [
        2144,
        480
      ],
      "parameters": {
        "jsCode": "const items = $input.all();\nconst updatedItems = items.map((item) => {\n  const waNo = item?.json[\"WhatsApp No\"];\n  const waNoStr = typeof waNo === 'string' ? waNo : (waNo !== undefined && waNo !== null ? String(waNo) : \"\");\n  const cleanedNumber = waNoStr.replace(/\\D/g, \"\");\n  item.json[\"WhatsApp No\"] = cleanedNumber;\n  return item;\n});\nreturn updatedItems;"
      },
      "typeVersion": 2
    },
    {
      "id": "abde1a8c-9505-4ad0-a31f-1b85938abcee",
      "name": "Verify WhatsApp Number Using Rapiwa",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2368,
        480
      ],
      "parameters": {
        "url": "=https://app.rapiwa.com/api/verify-whatsapp",
        "method": "POST",
        "options": {},
        "sendQuery": true,
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "queryParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $json['WhatsApp No'] }}"
            }
          ]
        }
      },
      "credentials": {
        "httpBearerAuth": {
          "id": "jnaHCyYia9OAFozh",
          "name": "Rapiwa Bearer YOUR_TOKEN_HERE"
        }
      },
      "executeOnce": false,
      "typeVersion": 4.2
    },
    {
      "id": "6d75fb8a-4d5a-4e5f-8967-2cbe2b9a7a9f",
      "name": "Trigger Every 10 Minute",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        944,
        560
      ],
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "typeVersion": 1.2
    },
    {
      "id": "61e401e3-7b43-45de-9eed-bf5850d84159",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        736,
        -80
      ],
      "parameters": {
        "width": 400,
        "height": 944,
        "content": "## Trigger Every 10 Minute\n- **Purpose:** Automatically starts the workflow every 10 minutes.\n- **Setup:** No changes needed unless you want a different interval.\n- **Note:** Make sure the schedule trigger node is enabled."
      },
      "typeVersion": 1
    },
    {
      "id": "2ba45f56-e064-4995-b064-dbc51eb61ecb",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1168,
        -80
      ],
      "parameters": {
        "color": 4,
        "width": 512,
        "height": 944,
        "content": "## Fetch All Pending Contacts for Verifing\n- **Purpose:** Retrieves up to 200 contacts from your Google Sheet that need verification.\n- **Setup:**  \n  - Connect your Google Sheets OAuth2 credentials.  \n  - Set the correct **Document ID** and **Sheet Name** for your contacts.  \n  - Apply filters to select only rows where `WA Checked` is empty or false.\n\n---\n\n## & Limit\n- **Purpose:** Limits the workflow to process a maximum of 200 contacts each run.\n- **Setup:**  \n  - Adjust the limit value if you want to process more or fewer contacts per run.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "dc3e5c48-ad64-4872-97af-5f195a279b9c",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2048,
        -80
      ],
      "parameters": {
        "color": 6,
        "width": 544,
        "height": 944,
        "content": "## Clean WhatsApp Number\n- **Purpose:** Removes non-digit characters from the WhatsApp number.\n- **Setup:**  \n  - No configuration needed unless your data format changes.  \n  - Custom JavaScript code is already included to clean numbers.\n\n---\n\n## & Verify WhatsApp Number Using Rapiwa\n- **Purpose:** Calls the Rapiwa API to verify WhatsApp number existence.\n- **Setup:**  \n  - Add your Rapiwa API Bearer YOUR_TOKEN_HERE in the HTTP Request credentials.  \n  - Confirm the POST URL and parameters are correct.\n"
      },
      "typeVersion": 1
    },
    {
      "id": "1b5e6c32-baf7-468a-9a46-d8c2c3d94e77",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1712,
        -80
      ],
      "parameters": {
        "color": 5,
        "width": 304,
        "height": 944,
        "content": "## Loop Over Items\n- **Purpose:** Splits the contacts into batches for individual processing.\n- **Setup:**  \n  - No special config, but make sure batch size fits API rate limits and performance."
      },
      "typeVersion": 1
    },
    {
      "id": "f512bef9-a564-46c6-9736-455ff03edcbe",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2624,
        -80
      ],
      "parameters": {
        "color": 2,
        "width": 704,
        "height": 944,
        "content": "## If\n- **Purpose:** Checks the API response to decide if the number exists or not.\n- **Setup:**  \n  - Ensure the condition matches the API response format (boolean true/false).\n\n---\n\n## & Set Status Verified\n- **Purpose:** Marks numbers verified by the API as “Verified.”\n- **Setup:**  \n  - No config needed; just outputs status text for later use.\n\n---\n\n## & Set Status Unverified\n- **Purpose:** Marks numbers not verified by the API as “Unverified.”\n- **Setup:**  \n  - No config needed; just outputs status text for later use."
      },
      "typeVersion": 1
    },
    {
      "id": "45d902d9-8d53-4cd4-868b-cc4ed6842011",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3360,
        -80
      ],
      "parameters": {
        "color": 4,
        "width": 320,
        "height": 944,
        "content": "## Change State of Rows in Checked\n- **Purpose:** Updates the Google Sheet row to:  \n  - Mark the contact as checked  \n  - Update verification status  \n  - Update cleaned WhatsApp number  \n- **Setup:**  \n  - Confirm the correct Document ID and Sheet Name.  \n  - Map columns accurately (`WA Checked`, `Verified/Unverified`, `WhatsApp No`, `row_number`).\n\n---"
      },
      "typeVersion": 1
    },
    {
      "id": "25dd2565-5d97-4656-998e-fa8d57051e48",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3712,
        -80
      ],
      "parameters": {
        "color": 3,
        "width": 272,
        "height": 944,
        "content": "\n## Wait\n- **Purpose:** Pauses the workflow for 3 seconds between batches to prevent rate limit issues.\n- **Setup:**  \n  - Adjust the wait time if needed based on your API’s rate limits."
      },
      "typeVersion": 1
    }
  ],
  "active": false,
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "e20888ed-0c6c-4156-8f2f-c35fac335983",
  "connections": {
    "If": {
      "main": [
        [
          {
            "node": "Set Status Verified",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Status Unverified",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Clean WhatsApp Number",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Status Verified": {
      "main": [
        [
          {
            "node": "Change State of Rows in Checked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean WhatsApp Number": {
      "main": [
        [
          {
            "node": "Verify WhatsApp Number Using Rapiwa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Status Unverified": {
      "main": [
        [
          {
            "node": "Change State of Rows in Checked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trigger Every 10 Minute": {
      "main": [
        [
          {
            "node": "Fetch All Pending Contacts for Verifing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Change State of Rows in Checked": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verify WhatsApp Number Using Rapiwa": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch All Pending Contacts for Verifing": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}