{
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Build Document Q&A API with PDF Vector and Webhooks",
    "wechat": "youandme10086",
    "id": 8498,
    "update_time": "2025-11-10"
  },
  "nodes": [
    {
      "id": "overview-note",
      "name": "API Overview",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        50,
        50
      ],
      "parameters": {
        "color": 5,
        "width": 350,
        "height": 160,
        "content": "## ðŸ¤– Document Q&A API\n\nRESTful service for document intelligence:\nâ€¢ **Webhook** endpoint accepts documents\nâ€¢ **AI processes** questions in context\nâ€¢ **Returns** JSON with answers & citations\nâ€¢ **Sub-second** response times"
      },
      "typeVersion": 1
    },
    {
      "id": "request-note",
      "name": "Request Format",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        450,
        450
      ],
      "parameters": {
        "width": 280,
        "height": 180,
        "content": "## ðŸ“¥ API Request\n\n**POST** to `/document-qa`\n\nBody:\n```json\n{\n  \"question\": \"Your question\",\n  \"maxTokens\": 500,\n  \"file\": <binary>\n}\n```"
      },
      "typeVersion": 1
    },
    {
      "id": "process-note",
      "name": "Q&A Processing",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        850,
        450
      ],
      "parameters": {
        "width": 260,
        "height": 160,
        "content": "## ðŸ” AI Processing\n\nPDF Vector:\nâ€¢ Parses document\nâ€¢ Finds relevant sections\nâ€¢ Generates answer\nâ€¢ Includes citations\n\nðŸ’¡ GPT-4 powered"
      },
      "typeVersion": 1
    },
    {
      "id": "response-note",
      "name": "Response Format",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1150,
        450
      ],
      "parameters": {
        "color": 6,
        "width": 260,
        "height": 180,
        "content": "## ðŸ“¤ API Response\n\n```json\n{\n  \"success\": true,\n  \"answer\": \"...\",\n  \"sources\": [...],\n  \"confidence\": 0.95\n}\n```\n\nâœ… Production ready!"
      },
      "typeVersion": 1
    },
    {
      "id": "webhook-trigger",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "notes": "API endpoint for document Q&A",
      "position": [
        250,
        300
      ],
      "webhookId": "doc-qa-webhook",
      "parameters": {
        "path": "doc-qa",
        "httpMethod": "POST"
      },
      "typeVersion": 1
    },
    {
      "id": "validate-request",
      "name": "Validate Request",
      "type": "n8n-nodes-base.code",
      "notes": "Validate and prepare request",
      "position": [
        450,
        300
      ],
      "parameters": {
        "jsCode": "// Validate incoming request\nconst body = $input.first().json.body;\nconst errors = [];\n\nif (!body.documentUrl && !body.documentId) {\n  errors.push('Either documentUrl or documentId is required');\n}\nif (!body.question) {\n  errors.push('Question is required');\n}\n\n// Generate session ID if not provided\nconst sessionId = body.sessionId || `session-${Date.now()}`;\n\nreturn [{\n  json: {\n    ...body,\n    sessionId,\n    valid: errors.length === 0,\n    errors,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "typeVersion": 2
    },
    {
      "id": "check-valid",
      "name": "Valid Request?",
      "type": "n8n-nodes-base.if",
      "position": [
        650,
        300
      ],
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.valid }}",
              "value2": true
            }
          ]
        }
      },
      "typeVersion": 1
    },
    {
      "id": "pdfvector-ask",
      "name": "PDF Vector - Ask Question",
      "type": "n8n-nodes-pdfvector.pdfVector",
      "notes": "Get answer from document",
      "position": [
        850,
        250
      ],
      "parameters": {
        "url": "={{ $json.documentUrl }}",
        "prompt": "Answer the following question about this document or image: {{ $json.question }}",
        "resource": "document",
        "inputType": "url",
        "operation": "ask"
      },
      "typeVersion": 1
    },
    {
      "id": "format-success",
      "name": "Format Success Response",
      "type": "n8n-nodes-base.code",
      "notes": "Prepare successful response",
      "position": [
        1050,
        250
      ],
      "parameters": {
        "jsCode": "// Prepare successful response\nconst answer = $json.answer;\nconst request = $node['Validate Request'].json;\n\n// Calculate confidence score based on answer length and keywords\nlet confidence = 0.8; // Base confidence\nif (answer.length > 100) confidence += 0.1;\nif (answer.toLowerCase().includes('specifically') || answer.toLowerCase().includes('according to')) confidence += 0.1;\nconfidence = Math.min(confidence, 1.0);\n\nreturn [{\n  json: {\n    success: true,\n    data: {\n      answer,\n      confidence,\n      sessionId: request.sessionId,\n      documentUrl: request.documentUrl,\n      question: request.question\n    },\n    metadata: {\n      processedAt: new Date().toISOString(),\n      responseTime: Date.now() - new Date(request.timestamp).getTime(),\n      creditsUsed: 1\n    }\n  }\n}];"
      },
      "typeVersion": 2
    },
    {
      "id": "format-error",
      "name": "Format Error Response",
      "type": "n8n-nodes-base.code",
      "notes": "Prepare error response",
      "position": [
        850,
        350
      ],
      "parameters": {
        "jsCode": "// Prepare error response\nconst errors = $json.errors || ['An error occurred processing your request'];\n\nreturn [{\n  json: {\n    success: false,\n    errors,\n    message: 'Invalid request',\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "typeVersion": 2
    },
    {
      "id": "webhook-response",
      "name": "Send Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "notes": "Send API response",
      "position": [
        1250,
        300
      ],
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json) }}",
        "responseHeaders": {
          "entries": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        }
      },
      "typeVersion": 1
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Validate Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Valid Request?": {
      "main": [
        [
          {
            "node": "PDF Vector - Ask Question",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Request": {
      "main": [
        [
          {
            "node": "Valid Request?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Error Response": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Success Response": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PDF Vector - Ask Question": {
      "main": [
        [
          {
            "node": "Format Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}