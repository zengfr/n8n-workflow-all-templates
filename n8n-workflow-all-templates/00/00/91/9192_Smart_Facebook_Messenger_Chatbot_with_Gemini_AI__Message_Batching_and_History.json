{
  "meta": {
    "site": "https://github.com/zengfr/n8n-workflow-all-templates",
    "name": "Smart Facebook Messenger Chatbot with Gemini AI, Message Batching and History",
    "wechat": "youandme10086",
    "id": 9192,
    "update_time": "2025-11-10"
  },
  "nodes": [
    {
      "id": "98cdc87a-0f97-4ce2-8a05-f9fad4fbb47c",
      "name": "Is Max ID?",
      "type": "n8n-nodes-base.if",
      "position": [
        1008,
        -112
      ],
      "parameters": {},
      "typeVersion": 2.2
    },
    {
      "id": "c9ef8f13-7f91-49bf-99bb-a06c540ba680",
      "name": "Send Typing",
      "type": "n8n-nodes-base.httpRequest",
      "onError": "continueRegularOutput",
      "position": [
        1536,
        -256
      ],
      "parameters": {},
      "typeVersion": 4.2
    },
    {
      "id": "66b05dc9-67f2-42dd-9535-0358801055fc",
      "name": "Is message?",
      "type": "n8n-nodes-base.if",
      "onError": "continueRegularOutput",
      "position": [
        -608,
        -208
      ],
      "parameters": {},
      "typeVersion": 2.2
    },
    {
      "id": "945a574e-6013-4828-b53e-227cc1f5e72f",
      "name": "Is from page?",
      "type": "n8n-nodes-base.if",
      "onError": "continueRegularOutput",
      "position": [
        -384,
        -208
      ],
      "parameters": {},
      "typeVersion": 2.2
    },
    {
      "id": "ba78b201-6798-4ceb-8ef3-f5446a33db47",
      "name": "Confirm Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        -608,
        -400
      ],
      "parameters": {},
      "typeVersion": 1.4
    },
    {
      "id": "aa1438a6-b174-4f28-b49b-2d5453a804d9",
      "name": "Facebook Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -832,
        -304
      ],
      "webhookId": "b12c5f3e-a7d7-4f0e-bd18-7b40f7c5f0d3",
      "parameters": {},
      "typeVersion": 2.1
    },
    {
      "id": "9611d38c-5115-460e-b9cf-1183913e93bf",
      "name": "Seen",
      "type": "n8n-nodes-base.httpRequest",
      "onError": "continueRegularOutput",
      "position": [
        64,
        -304
      ],
      "parameters": {},
      "typeVersion": 4.2
    },
    {
      "id": "0ac00a0d-a627-4b67-8cd7-893aa6ad5181",
      "name": "Send Text",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2480,
        -80
      ],
      "parameters": {},
      "typeVersion": 4.2
    },
    {
      "id": "71f74233-caf5-4ddd-b3b7-1f872338539c",
      "name": "Set Context",
      "type": "n8n-nodes-base.set",
      "position": [
        -160,
        -208
      ],
      "parameters": {},
      "typeVersion": 3.4
    },
    {
      "id": "5291b6a6-0151-4282-af9f-32f637ccb61c",
      "name": "Insert To Process",
      "type": "n8n-nodes-base.dataTable",
      "position": [
        64,
        -112
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "a1140766-f895-4713-9911-e6aead996b83",
      "name": "Get unprocessed message",
      "type": "n8n-nodes-base.dataTable",
      "position": [
        512,
        -112
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "36bfb457-dd1f-4e40-892d-954582980ef3",
      "name": "Update Page Rep",
      "type": "n8n-nodes-base.dataTable",
      "position": [
        2688,
        0
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "af7ae4cc-fa6d-4825-b64a-51219ab37aa2",
      "name": "Update FALSE to TRUE",
      "type": "n8n-nodes-base.dataTable",
      "position": [
        2688,
        -160
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "d397a1c2-ca12-49de-8926-3467d180300c",
      "name": "Format for Facebook Output",
      "type": "n8n-nodes-base.code",
      "position": [
        2288,
        -80
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "633ae695-402b-4ce5-b303-5e7403dc7ce4",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -880,
        -944
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "7a2d3e40-921b-4f3e-b744-6de691988fb1",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        -944
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "7b74805b-56d7-42dd-9f86-e00fac90f0cc",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1216,
        -944
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "b3c91dc3-d19b-4f7d-9677-2f34a578590e",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2224,
        -944
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "ac913ab6-1fb1-4abf-bae0-9d7a7db5fbb3",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -880,
        -1712
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "536f5f3e-6a86-46a8-a215-edb22a977173",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2224,
        -1712
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "452fdb7f-16d2-4a8a-be73-07764edff67a",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        -1712
      ],
      "parameters": {
        "content": ""
      },
      "typeVersion": 1
    },
    {
      "id": "a921c1dc-41b2-4c38-9e84-c6f08539c1e7",
      "name": "Get Max ID + Merged Mess",
      "type": "n8n-nodes-base.code",
      "position": [
        736,
        -112
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "afd17a05-bc0d-4161-ac97-35f777092ec1",
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        1792,
        160
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "2949eb67-e386-47ea-a987-cc80aee98cb7",
      "name": "Process Merged Message",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1904,
        -64
      ],
      "parameters": {},
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 100
    },
    {
      "id": "22e7bdbd-52de-4859-97d0-966fbf361d46",
      "name": "Get history message",
      "type": "n8n-nodes-base.dataTable",
      "position": [
        1312,
        -64
      ],
      "parameters": {},
      "typeVersion": 1,
      "alwaysOutputData": true
    },
    {
      "id": "ea44a0d9-0e5e-4f45-be4f-22fa5c30301c",
      "name": "Merge History",
      "type": "n8n-nodes-base.code",
      "position": [
        1712,
        -64
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "34113efa-bdde-4086-b907-732a1da31990",
      "name": "Groq Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "position": [
        1952,
        176
      ],
      "parameters": {},
      "typeVersion": 1
    },
    {
      "id": "f270db75-aea2-434c-a4d9-f6098301f70b",
      "name": "Get 15 newest rows",
      "type": "n8n-nodes-base.code",
      "position": [
        1520,
        -64
      ],
      "parameters": {},
      "typeVersion": 2
    },
    {
      "id": "fa878cbb-e5e2-43ed-8daf-be71b0555282",
      "name": "Wait 5s",
      "type": "n8n-nodes-base.wait",
      "position": [
        288,
        -112
      ],
      "webhookId": "bec8714e-5c19-4ff8-9644-f8ba6e8ecdfd",
      "parameters": {},
      "typeVersion": 1.1
    }
  ],
  "pinData": {},
  "connections": {
    "Wait 5s": {
      "main": [
        [
          {
            "node": "Get unprocessed message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Text": {
      "main": [
        [
          {
            "node": "Update Page Rep",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update FALSE to TRUE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Max ID?": {
      "main": [
        [
          {
            "node": "Send Typing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get history message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is message?": {
      "main": [
        [
          {
            "node": "Is from page?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Typing": {
      "main": [
        []
      ]
    },
    "Set Context": {
      "main": [
        [
          {
            "node": "Insert To Process",
            "type": "main",
            "index": 0
          },
          {
            "node": "Seen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is from page?": {
      "main": [
        [],
        [
          {
            "node": "Set Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge History": {
      "main": [
        [
          {
            "node": "Process Merged Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Process Merged Message",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Update Page Rep": {
      "main": [
        []
      ]
    },
    "Facebook Webhook": {
      "main": [
        [
          {
            "node": "Confirm Webhook",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is message?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Confirm Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert To Process": {
      "main": [
        [
          {
            "node": "Wait 5s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get 15 newest rows": {
      "main": [
        [
          {
            "node": "Merge History",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get history message": {
      "main": [
        [
          {
            "node": "Get 15 newest rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Merged Message": {
      "main": [
        [
          {
            "node": "Format for Facebook Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get unprocessed message": {
      "main": [
        [
          {
            "node": "Get Max ID + Merged Mess",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Max ID + Merged Mess": {
      "main": [
        [
          {
            "node": "Is Max ID?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Process Merged Message",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Format for Facebook Output": {
      "main": [
        [
          {
            "node": "Send Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}